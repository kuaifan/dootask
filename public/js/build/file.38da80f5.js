import{_ as u}from"./openpgp_hi.15f91b1d.js";import{m as f}from"./vuex.cc7cb26e.js";import{l as m}from"./lodash.96669e56.js";import{D as v}from"./index.de3fdb79.js";import{l as g}from"./longpress.6c9d7403.js";import{U as $,n as _}from"./app.fe1cd649.js";import{U as k}from"./tip.2ea44d3a.js";import"./@babel.43d8d0a5.js";import"./@micro-zoe.c2e1472d.js";import"./jquery.f44c3c79.js";import"./dayjs.aaefe451.js";import"./localforage.bd4872f5.js";import"./markdown-it.6846e2b0.js";import"./entities.797c3e49.js";import"./uc.micro.700527ef.js";import"./mdurl.95c1032c.js";import"./linkify-it.96515e28.js";import"./punycode.50f384b0.js";import"./highlight.js.ab8aeea4.js";import"./markdown-it-link-attributes.e1d5d151.js";import"./@traptitech.64308959.js";import"./vue.296078bd.js";import"./axios.6ec123f8.js";import"./le5le-store.d4b5b622.js";import"./vue-router.2d566cd7.js";import"./vue-clipboard2.ad7135d3.js";import"./clipboard.3f21bed6.js";import"./view-design-hi.609f8897.js";import"./vuedraggable.6ea348a4.js";import"./sortablejs.982d79d6.js";import"./vue-resize-observer.e788af6d.js";import"./element-sea.c283d284.js";import"./deepmerge.cecf392e.js";import"./resize-observer-polyfill.37526d89.js";import"./throttle-debounce.7c3948b2.js";import"./babel-helper-vue-jsx-merge-props.5ed215c3.js";import"./normalize-wheel.2a034b9f.js";import"./async-validator.e7e40052.js";import"./babel-runtime.4773988a.js";import"./core-js.314b4a1d.js";var w=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"page-file"},[t("PageTitle",{attrs:{title:e.$L("\u6587\u4EF6")}}),t("div",{ref:"fileWrapper",staticClass:"file-wrapper"},[t("div",{staticClass:"file-head"},[t("div",{staticClass:"file-nav"},[t("div",{staticClass:"common-nav-back portrait",on:{click:function(s){return e.goForward({name:"manage-application"},!0)}}},[t("i",{staticClass:"taskfont"},[e._v("\uE676")])]),t("h1",[e._v(e._s(e.$L("\u6587\u4EF6")))]),e.loadIng==0?t("div",{staticClass:"file-refresh",on:{click:e.getFileList}},[t("i",{staticClass:"taskfont"},[e._v("\uE6AE")])]):e._e()]),e.uploadList.length>0?t("div",{staticClass:"file-status",on:{click:function(s){e.uploadShow=!0,e.packShow=!1}}},[e.uploadList.find(function(s){var a=s.status;return a!=="finished"})?t("Loading"):t("Button",{attrs:{shape:"circle",icon:"md-arrow-round-up"}})],1):e._e(),e.packList.length>0?t("div",{staticClass:"file-status",on:{click:function(s){e.packShow=!0,e.uploadShow=!1}}},[e.packList.find(function(s){var a=s.status;return a!=="finished"})?t("Loading"):t("Button",{attrs:{shape:"circle",icon:"md-arrow-round-down"}})],1):e._e(),t("div",{class:["file-search",e.searchKey?"has-value":""],on:{click:e.onSearchFocus,mouseenter:e.onSearchFocus}},[t("Input",{ref:"searchInput",attrs:{suffix:"ios-search",placeholder:e.$L("\u641C\u7D22\u540D\u79F0")},on:{"on-change":e.onSearchChange},model:{value:e.searchKey,callback:function(s){e.searchKey=s},expression:"searchKey"}})],1),t("div",{staticClass:"file-add"},[t("Button",{attrs:{shape:"circle",icon:"md-add"},on:{click:function(s){return s.stopPropagation(),e.handleRightClick(s,null,!0)}}})],1)]),t("div",{staticClass:"file-navigator"},[t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showBtnText||!e.selectIds.length&&!e.shearFirst,expression:"showBtnText || (!selectIds.length && !shearFirst)"}],staticClass:"scrollbar-hidden"},[t("li",{on:{click:function(s){return e.browseFolder(0)}}},[t("span",[e._v(e._s(e.$L("\u5168\u90E8\u6587\u4EF6")))])]),e.searchKey?t("li",[e._v(e._s(e.$L("\u641C\u7D22"))+' "'+e._s(e.searchKey)+'"')]):e._l(e.navigator,function(s){return t("li",{ref:`nav_${s.id}`,refInFor:!0,on:{click:function(a){return e.browseFolder(s.id)}}},[s.share?t("i",{staticClass:"taskfont"},[e._v("\uE63F")]):e._e(),t("span",{attrs:{title:s.name}},[e._v(e._s(s.name))]),s.share&&s.permission==0?t("span",{staticClass:"readonly"},[e._v(e._s(e.$L("\u53EA\u8BFB")))]):e._e()])})],2),e.shearFirst?[t("Button",{style:{marginLeft:e.showBtnText?"12px":0},attrs:{disabled:e.shearFirst.pid==e.pid,size:"small",type:"primary"},on:{click:e.shearTo}},[t("div",{staticClass:"file-shear"},[t("span",[e._v(e._s(e.$L("\u7C98\u8D34")))]),[e._v('"'),t("em",[e._v(e._s(e.shearFirst.name))]),e._v('"')],e.shearIds.length>1?t("span",[e._v(e._s(e.$L(`\u7B49${e.shearIds.length}\u4E2A\u6587\u4EF6`)))]):e._e()],2)]),t("Button",{attrs:{type:"primary",size:"small"},on:{click:e.clearShear}},[e._v(e._s(e.$L("\u53D6\u6D88\u526A\u5207")))])]:e.selectIds.length>0?[t("Button",{style:{marginLeft:e.showBtnText?"12px":0},attrs:{size:"small",type:"info"},on:{click:function(s){return e.handleContextClick("shearSelect")}}},[t("div",{staticClass:"tool-box"},[t("Icon",{attrs:{type:"ios-cut"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.showBtnText,expression:"showBtnText"}]},[e._v(e._s(e.$L("\u526A\u5207")))])],1)]),e.selectIds.length>1?t("Button",{attrs:{disabled:e.compressedSownloadDisabled,size:"small",type:"info"},on:{click:function(s){return e.downloadZipFile(e.selectIds)}}},[t("div",{staticClass:"tool-box"},[t("Icon",{attrs:{type:"ios-download"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.showBtnText,expression:"showBtnText"}]},[e._v(e._s(e.$L("\u6253\u5305\u4E0B\u8F7D")))])],1)]):e._e(),t("Button",{attrs:{size:"small",type:"error"},on:{click:function(s){return e.deleteFile(e.selectIds)}}},[t("div",{staticClass:"tool-box"},[t("Icon",{attrs:{type:"ios-trash"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.showBtnText,expression:"showBtnText"}]},[e._v(e._s(e.$L("\u5220\u9664")))])],1)]),t("Button",{attrs:{type:"primary",size:"small"},on:{click:e.clearSelect}},[e._v(" "+e._s(e.showBtnText?e.$L("\u53D6\u6D88\u9009\u62E9"):e.$L("\u53D6\u6D88"))+" ")])]:e._e(),e.loadIng>0?t("div",{staticClass:"nav-load"},[t("Loading")],1):e._e(),t("div",{staticClass:"flex-full"}),e.hasShareFile?t("div",{staticClass:"only-checkbox"},[t("Checkbox",{model:{value:e.hideShared,callback:function(s){e.hideShared=s},expression:"hideShared"}},[e._v(" "+e._s(e.showBtnText?e.$L("\u4EC5\u663E\u793A\u6211\u7684"):e.$L("\u4EC5\u6211\u7684"))+" ")])],1):e._e(),t("div",{class:["switch-button",e.tableMode]},[t("div",{on:{click:function(s){e.tableMode="block"}}},[t("i",{staticClass:"taskfont"},[e._v("\uE60C")])]),t("div",{on:{click:function(s){e.tableMode="table"}}},[t("i",{staticClass:"taskfont"},[e._v("\uE66A")])])])],2),t("div",{staticClass:"file-drag",on:{drop:function(s){return s.preventDefault(),e.filePasteDrag(s,"drag")},dragover:function(s){return s.preventDefault(),e.fileDragOver(!0,s)},dragleave:function(s){return s.preventDefault(),e.fileDragOver(!1,s)}}},[e.tableMode==="table"?t("div",{staticClass:"file-table",on:{contextmenu:function(s){return s.preventDefault(),e.handleContextmenu.apply(null,arguments)}}},[t("Table",{attrs:{columns:e.columns,data:e.fileList,height:e.tableHeight,"no-data-text":e.$L("\u6CA1\u6709\u4EFB\u4F55\u6587\u4EF6"),"context-menu":"",stripe:""},on:{"on-cell-click":e.clickRow,"on-contextmenu":e.handleContextMenu,"on-select":e.handleTableSelect,"on-select-cancel":e.handleTableSelect,"on-select-all-cancel":e.handleTableSelect,"on-select-all":e.handleTableSelect,"on-sort-change":e.handleTableSort}})],1):[e.fileList.length==0&&e.loadIng==0?t("div",{staticClass:"file-no",on:{contextmenu:function(s){return s.preventDefault(),e.handleContextmenu.apply(null,arguments)}}},[t("i",{staticClass:"taskfont"},[e._v("\uE60B")]),t("p",[e._v(e._s(e.$L("\u6CA1\u6709\u4EFB\u4F55\u6587\u4EF6")))])]):t("div",{staticClass:"file-list",on:{contextmenu:function(s){return s.preventDefault(),e.handleContextmenu.apply(null,arguments)}}},[t("ul",e._l(e.fileList,function(s){return t("li",[t("div",{directives:[{name:"longpress",rawName:"v-longpress",value:e.handleLongpress,expression:"handleLongpress"}],staticClass:"file-item",class:{shear:e.shearIds.includes(s.id),highlight:e.selectIds.includes(s.id),operate:e.contextMenuVisible&&s.id===e.contextMenuItem.id},attrs:{"data-id":s.id},on:{click:function(a){return e.dropFile(s,"openCheckMenu")}}},[t("div",{staticClass:"file-check",class:{"file-checked":e.selectIds.includes(s.id)},on:{click:function(a){return a.stopPropagation(),e.dropFile(s,"select")}}},[t("Checkbox",{attrs:{value:e.selectIds.includes(s.id)}})],1),t("div",{staticClass:"file-menu",on:{click:function(a){return a.stopPropagation(),e.handleRightClick(a,s)}}},[t("Icon",{attrs:{type:"ios-more"}})],1),t("div",{class:`no-dark-before file-icon ${s.type}${s.share?" share":""}`},[s.share?[s.userid!=e.userId?t("UserAvatarTip",{staticClass:"share-avatar",attrs:{userid:s.userid,size:20}},[t("p",[e._v(e._s(e.$L("\u5171\u4EAB\u6743\u9650"))+": "+e._s(e.$L(s.permission==1?"\u8BFB/\u5199":"\u53EA\u8BFB")))])]):t("div",{staticClass:"share-icon no-dark-content"},[t("i",{staticClass:"taskfont"},[e._v("\uE757")])])]:e.isParentShare?[t("UserAvatarTip",{staticClass:"share-avatar",attrs:{userid:s.created_id,size:20}},[s.created_id!=s.userid?t("p",[t("strong",[e._v(e._s(e.$L("\u6210\u5458\u521B\u5EFA\u4E8E"))+": "+e._s(s.created_at))])]):t("p",[e._v(e._s(e.$L("\u6240\u6709\u8005\u521B\u5EFA\u4E8E"))+": "+e._s(s.created_at))])])]:e._e()],2),s._edit?t("div",{staticClass:"file-input"},[t("Input",{ref:"input_"+s.id,refInFor:!0,attrs:{size:"small",disabled:!!s._load,parser:e.onParser},on:{"on-blur":function(a){return e.onBlur(s)},"on-keyup":function(a){return e.onKeyup(a,s)}},model:{value:s.newname,callback:function(a){e.$set(s,"newname",a)},expression:"item.newname"}}),s._load?t("div",{staticClass:"file-load"},[t("Loading")],1):e._e()],1):t("div",{staticClass:"file-name",attrs:{title:s.name}},[e._v(e._s(e.$A.getFileName(s)))])])])}),0)])],e.dialogDrag?t("div",{staticClass:"drag-over",on:{click:function(s){e.dialogDrag=!1}}},[t("div",{staticClass:"drag-text"},[e._v(e._s(e.$L("\u62D6\u52A8\u5230\u8FD9\u91CC\u53D1\u9001")))])]):e._e()],2),t("div",{staticClass:"file-menu",style:e.contextMenuStyles},[t("Dropdown",{attrs:{trigger:"custom",visible:e.contextMenuVisible,"transfer-class-name":"page-file-dropdown-menu",transfer:""},on:{"on-click":e.handleContextClick,"on-clickoutside":e.handleClickContextMenuOutside,"on-visible-change":e.handleVisibleChangeMenu}},[t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e.contextMenuItem.id?[t("DropdownItem",{staticClass:"item-open",attrs:{name:"open"}},[e._v(" "+e._s(e.$L("\u6253\u5F00"))+" "),t("div",{staticClass:"open-name"},[e._v("\u201C"+e._s(e.contextMenuItem.name)+"\u201D")])]),e.searchKey?t("DropdownItem",{staticClass:"item-open",attrs:{name:"upperFolder"}},[e._v(" "+e._s(e.$L("\u5728\u4E0A\u5C42\u6587\u4EF6\u5939\u4E2D\u663E\u793A"))+" ")]):e._e(),t("DropdownItem",{attrs:{name:"select"}},[e._v(e._s(e.$L(e.selectIds.includes(e.contextMenuItem.id)?"\u53D6\u6D88\u9009\u62E9":"\u9009\u62E9")))]),t("Dropdown",{attrs:{placement:"right-start",transfer:""}},[t("DropdownItem",{attrs:{divided:"",name:"new:"},nativeOn:{click:function(s){s.stopPropagation()}}},[t("div",{staticClass:"arrow-forward-item"},[e._v(e._s(e.$L("\u65B0\u5EFA"))),t("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t("DropdownMenu",{staticClass:"page-file-dropdown-menu",attrs:{slot:"list"},slot:"list"},e._l(e.types,function(s,a){return s.label?t("DropdownItem",{key:a,attrs:{divided:!!s.divided,name:`new:${s.value}`}},[t("div",{class:`no-dark-before file-item file-icon ${s.value}`},[e._v(e._s(e.$L(s.label)))])]):e._e()}),1)],1),t("DropdownItem",{attrs:{name:"rename",divided:""}},[e._v(e._s(e.$L("\u91CD\u547D\u540D")))]),t("DropdownItem",{attrs:{name:"copy",disabled:e.contextMenuItem.type=="folder"}},[e._v(e._s(e.$L("\u590D\u5236")))]),t("DropdownItem",{attrs:{name:"shear",disabled:e.contextMenuItem.userid!=e.userId}},[e._v(e._s(e.$L("\u526A\u5207")))]),e.contextMenuItem.userid==e.userId?t("DropdownItem",{attrs:{name:"share",divided:""}},[e._v(e._s(e.$L("\u5171\u4EAB")))]):e.contextMenuItem.share?t("DropdownItem",{attrs:{name:"outshare",divided:""}},[e._v(e._s(e.$L("\u9000\u51FA\u5171\u4EAB")))]):e._e(),t("DropdownItem",{attrs:{name:"send",disabled:e.contextMenuItem.type=="folder"}},[e._v(e._s(e.$L("\u53D1\u9001")))]),t("DropdownItem",{attrs:{name:"link",divided:e.contextMenuItem.userid!=e.userId&&!e.contextMenuItem.share,disabled:e.contextMenuItem.type=="folder"}},[e._v(e._s(e.$L("\u94FE\u63A5")))]),t("DropdownItem",{attrs:{name:"download",disabled:e.contextMenuItem.ext==""||e.contextMenuItem.userid!=e.userId&&e.contextMenuItem.permission==0}},[e._v(e._s(e.$L("\u4E0B\u8F7D")))]),e.selectIds.length>1?t("DropdownItem",{attrs:{name:"downloadzip",disabled:e.contextMenuItem.userid!=e.userId&&e.contextMenuItem.permission==0}},[e._v(e._s(e.$L("\u6253\u5305\u4E0B\u8F7D")))]):e._e(),t("DropdownItem",{staticStyle:{color:"red"},attrs:{name:"delete",divided:""}},[e._v(e._s(e.$L("\u5220\u9664")))])]:e._l(e.types,function(s,a){return s.label?t("DropdownItem",{key:a,attrs:{divided:!!s.divided,name:`new:${s.value}`}},[t("div",{class:`no-dark-before file-item file-icon ${s.value}`},[e._v(e._s(e.$L(s.label)))])]):e._e()})],2)],1)],1)]),e.uploadShow&&e.uploadList.length>0?t("div",{staticClass:"file-upload-list"},[t("div",{staticClass:"upload-wrap"},[t("div",{staticClass:"title"},[e._v(" "+e._s(e.$L("\u4E0A\u4F20\u5217\u8868"))+" ("+e._s(e.uploadList.length)+") "),e.uploadList.find(function(s){var a=s.status;return a==="finished"})?t("em",{on:{click:e.uploadClear}},[e._v(e._s(e.$L("\u6E05\u7A7A\u5DF2\u5B8C\u6210")))]):e._e()]),t("ul",{staticClass:"content"},e._l(e.uploadList,function(s,a){return a<100?t("li",{key:a,on:{click:function(r){return e.uploadClick(s)}}},[t("AutoTip",{staticClass:"file-name"},[t("span",{domProps:{innerHTML:e._s(e.uploadName(s))}})]),s.status==="finished"&&s.response&&s.response.ret!==1?t("AutoTip",{staticClass:"file-error"},[e._v(e._s(s.response.msg))]):t("Progress",{attrs:{percent:e.uploadPercentageParse(s.percentage),"stroke-width":5}}),t("Icon",{staticClass:"file-close",attrs:{type:"ios-close-circle-outline"},on:{click:function(r){return e.uploadList.splice(a,1)}}})],1):e._e()}),0),t("Icon",{staticClass:"close",attrs:{type:"md-close"},on:{click:function(s){e.uploadShow=!1}}})],1)]):e._e(),e.packShow&&e.packList.length>0?t("div",{staticClass:"file-upload-list"},[t("div",{staticClass:"upload-wrap"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(e.$L("\u6253\u5305\u5217\u8868"))+"("+e._s(e.packList.length)+")")]),e.packList.find(function(s){var a=s.status;return a==="finished"})?t("em",{on:{click:e.packClear}},[e._v(e._s(e.$L("\u6E05\u7A7A\u5DF2\u5B8C\u6210")))]):e._e()]),t("ul",{staticClass:"content"},e._l(e.packList,function(s,a){return a<100?t("li",{key:a},[t("AutoTip",{staticClass:"file-name"},[s.status!=="finished"?t("span",[e._v(e._s(s.name))]):t("a",{attrs:{href:s.url,target:"_blank"}},[e._v(e._s(s.name))])]),s.status==="finished"&&s.response&&s.response.ret!==1?t("AutoTip",{staticClass:"file-error"},[e._v(e._s(s.response.msg))]):t("Progress",{attrs:{percent:e.packPercentageParse(s.percentage),"stroke-width":5}}),t("Icon",{staticClass:"file-close",attrs:{type:"ios-close-circle-outline"},on:{click:function(r){return e.packList.splice(a,1)}}})],1):e._e()}),0),t("Icon",{staticClass:"close",attrs:{type:"md-close"},on:{click:function(s){e.packShow=!1}}})],1)]):e._e(),t("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileUpload",attrs:{name:"files",action:e.actionUrl,headers:e.headers,multiple:!0,webkitdirectory:!1,format:e.uploadFormat,accept:e.uploadAccept,"show-upload-list":!1,"max-size":e.maxSize,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-error":e.handleError,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,"before-upload":e.handleBeforeUpload}}),t("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"dirUpload",attrs:{name:"files",action:e.actionUrl,headers:e.headers,multiple:!0,webkitdirectory:!0,format:e.uploadFormat,accept:e.uploadAccept,"show-upload-list":!1,"max-size":e.maxSize,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-error":e.handleError,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,"before-upload":e.handleBeforeUpload}}),t("Modal",{attrs:{title:e.$L("\u5171\u4EAB\u8BBE\u7F6E"),"mask-closable":!1,"footer-hide":""},model:{value:e.shareShow,callback:function(s){e.shareShow=s},expression:"shareShow"}},[t("Form",{staticClass:"page-file-share-form",attrs:{model:e.shareInfo,inline:""},nativeOn:{submit:function(s){s.preventDefault()}}},[t("FormItem",{staticClass:"share-userid",attrs:{prop:"userids"}},[t("RadioGroup",{model:{value:e.shareInfo.type,callback:function(s){e.$set(e.shareInfo,"type",s)},expression:"shareInfo.type"}},[t("Radio",{attrs:{label:"all"}},[e._v(e._s(e.$L("\u6240\u6709\u4EBA")))]),t("Radio",{attrs:{label:"custom"}},[e._v(e._s(e.$L("\u6307\u5B9A\u6210\u5458")))])],1),e.shareInfo.type==="custom"?t("UserSelect",{attrs:{disabledChoice:e.shareAlready,"multiple-max":100,placeholder:e.$L("\u9009\u62E9\u5171\u4EAB\u6210\u5458"),"avatar-size":24,border:""},model:{value:e.shareInfo.userids,callback:function(s){e.$set(e.shareInfo,"userids",s)},expression:"shareInfo.userids"}}):e._e()],1),t("FormItem",[t("Select",{attrs:{placeholder:e.$L("\u6743\u9650")},model:{value:e.shareInfo.permission,callback:function(s){e.$set(e.shareInfo,"permission",s)},expression:"shareInfo.permission"}},[t("Option",{attrs:{value:1}},[e._v(e._s(e.$L("\u8BFB/\u5199")))]),t("Option",{attrs:{value:0}},[e._v(e._s(e.$L("\u53EA\u8BFB")))])],1)],1),t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.shareLoad>0},on:{click:e.onShare}},[e._v(e._s(e.$L("\u5171\u4EAB")))])],1)],1),e.shareList.length>0?t("div",{staticClass:"page-file-share-items"},[t("div",{staticClass:"page-file-share-title"},[e._v(e._s(e.$L("\u5DF2\u5171\u4EAB\u6210\u5458"))+":")]),t("ul",{staticClass:"page-file-share-list"},e._l(e.shareList,function(s){return t("li",[s.userid==0?t("div",{staticClass:"all-avatar"},[t("EAvatar",{staticClass:"avatar-text",attrs:{icon:"el-icon-s-custom"}}),t("span",{staticClass:"avatar-name"},[e._v(e._s(e.$L("\u6240\u6709\u4EBA")))])],1):t("UserAvatar",{attrs:{size:32,userid:s.userid,showName:""}}),t("Select",{attrs:{placeholder:e.$L("\u6743\u9650")},on:{"on-change":function(a){return e.upShare(s)}},model:{value:s.permission,callback:function(a){e.$set(s,"permission",a)},expression:"item.permission"}},[t("Option",{attrs:{value:1}},[e._v(e._s(e.$L("\u8BFB/\u5199")))]),t("Option",{attrs:{value:0}},[e._v(e._s(e.$L("\u53EA\u8BFB")))]),t("Option",{staticClass:"delete",attrs:{value:-1}},[e._v(e._s(e.$L("\u5220\u9664")))])],1)],1)}),0)]):e._e()],1),t("UserSelect",{ref:"sendFile",attrs:{"multiple-max":50,title:e.$L("\u53D1\u9001\u6587\u4EF6"),"before-submit":e.onSendFile,"show-select-all":!1,"show-dialog":"",module:""},model:{value:e.sendData,callback:function(s){e.sendData=s},expression:"sendData"}}),t("Modal",{attrs:{title:e.$L("\u6587\u4EF6\u94FE\u63A5"),"mask-closable":!1},model:{value:e.linkShow,callback:function(s){e.linkShow=s},expression:"linkShow"}},[t("div",[t("div",{staticStyle:{margin:"-10px 0 8px"}},[e._v(e._s(e.$L("\u6587\u4EF6\u540D\u79F0"))+": "+e._s(e.linkData.name))]),t("Input",{ref:"linkInput",attrs:{type:"textarea",rows:3,readonly:""},on:{"on-focus":e.linkFocus},model:{value:e.linkData.url,callback:function(s){e.$set(e.linkData,"url",s)},expression:"linkData.url"}}),t("div",{staticClass:"form-tip",staticStyle:{"padding-top":"6px"}},[e._v(" "+e._s(e.$L("\u53EF\u901A\u8FC7\u6B64\u94FE\u63A5\u6D4F\u89C8\u6587\u4EF6\u3002"))+" "),t("Poptip",{attrs:{confirm:"",placement:"bottom","ok-text":e.$L("\u786E\u5B9A"),"cancel-text":e.$L("\u53D6\u6D88"),transfer:""},on:{"on-ok":function(s){return e.linkGet(!0)}}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("p",[t("strong",[e._v(e._s(e.$L("\u6CE8\u610F\uFF1A\u5237\u65B0\u5C06\u5BFC\u81F4\u539F\u6765\u7684\u94FE\u63A5\u5931\u6548\uFF01")))])])]),t("a",{attrs:{href:"javascript:void(0)"}},[e._v(e._s(e.$L("\u5237\u65B0\u94FE\u63A5")))])])],1)],1),t("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"default"},on:{click:function(s){e.linkShow=!1}}},[e._v(e._s(e.$L("\u53D6\u6D88")))]),t("Button",{attrs:{type:"primary",loading:e.linkLoad>0},on:{click:e.linkCopy}},[e._v(e._s(e.$L("\u590D\u5236")))])],1)]),t("DrawerOverlay",{staticClass:"page-file-drawer",attrs:{beforeClose:e.fileBeforeClose,"mask-closable":!1},model:{value:e.fileShow,callback:function(s){e.fileShow=s},expression:"fileShow"}},[e.isPreview?t("FilePreview",{attrs:{file:e.fileInfo}}):t("FileContent",{ref:"fileContent",attrs:{file:e.fileInfo},model:{value:e.fileShow,callback:function(s){e.fileShow=s},expression:"fileShow"}})],1),t("Modal",{attrs:{title:e.$L(e.pasteTitle),"cancel-text":e.$L("\u53D6\u6D88"),"ok-text":e.$L("\u7ACB\u5373\u4E0A\u4F20"),"enter-ok":!0},on:{"on-ok":e.pasteSend},model:{value:e.pasteShow,callback:function(s){e.pasteShow=s},expression:"pasteShow"}},[t("ul",{staticClass:"dialog-wrapper-paste",class:e.pasteWrapperClass},e._l(e.pasteItem,function(s){return t("li",[s.type=="image"?t("img",{attrs:{src:s.result}}):t("div",[e._v(e._s(e.$L("\u6587\u4EF6"))+": "+e._s(s.name)+" ("+e._s(e.$A.bytesToSize(s.size))+")")])])}),0)])],1)},I=[];const L=()=>u(()=>import("./FilePreview.62482a89.js"),["js/build/FilePreview.62482a89.js","js/build/openpgp_hi.15f91b1d.js","js/build/IFrame.ad242f4b.js","js/build/app.fe1cd649.js","js/build/app.349f8b75.css","js/build/@micro-zoe.c2e1472d.js","js/build/jquery.f44c3c79.js","js/build/@babel.43d8d0a5.js","js/build/dayjs.aaefe451.js","js/build/localforage.bd4872f5.js","js/build/markdown-it.6846e2b0.js","js/build/entities.797c3e49.js","js/build/uc.micro.700527ef.js","js/build/mdurl.95c1032c.js","js/build/linkify-it.96515e28.js","js/build/punycode.50f384b0.js","js/build/highlight.js.ab8aeea4.js","js/build/markdown-it-link-attributes.e1d5d151.js","js/build/@traptitech.64308959.js","js/build/vue.296078bd.js","js/build/vuex.cc7cb26e.js","js/build/axios.6ec123f8.js","js/build/le5le-store.d4b5b622.js","js/build/vue-router.2d566cd7.js","js/build/vue-clipboard2.ad7135d3.js","js/build/clipboard.3f21bed6.js","js/build/view-design-hi.609f8897.js","js/build/vuedraggable.6ea348a4.js","js/build/sortablejs.982d79d6.js","js/build/vue-resize-observer.e788af6d.js","js/build/element-sea.c283d284.js","js/build/deepmerge.cecf392e.js","js/build/resize-observer-polyfill.37526d89.js","js/build/throttle-debounce.7c3948b2.js","js/build/babel-helper-vue-jsx-merge-props.5ed215c3.js","js/build/normalize-wheel.2a034b9f.js","js/build/async-validator.e7e40052.js","js/build/babel-runtime.4773988a.js","js/build/core-js.314b4a1d.js"]),x=()=>u(()=>import("./FileContent.4c521ac9.js"),["js/build/FileContent.4c521ac9.js","js/build/FileContent.6459ca29.css","js/build/openpgp_hi.15f91b1d.js","js/build/vuex.cc7cb26e.js","js/build/app.fe1cd649.js","js/build/app.349f8b75.css","js/build/@micro-zoe.c2e1472d.js","js/build/jquery.f44c3c79.js","js/build/@babel.43d8d0a5.js","js/build/dayjs.aaefe451.js","js/build/localforage.bd4872f5.js","js/build/markdown-it.6846e2b0.js","js/build/entities.797c3e49.js","js/build/uc.micro.700527ef.js","js/build/mdurl.95c1032c.js","js/build/linkify-it.96515e28.js","js/build/punycode.50f384b0.js","js/build/highlight.js.ab8aeea4.js","js/build/markdown-it-link-attributes.e1d5d151.js","js/build/@traptitech.64308959.js","js/build/vue.296078bd.js","js/build/axios.6ec123f8.js","js/build/le5le-store.d4b5b622.js","js/build/vue-router.2d566cd7.js","js/build/vue-clipboard2.ad7135d3.js","js/build/clipboard.3f21bed6.js","js/build/view-design-hi.609f8897.js","js/build/vuedraggable.6ea348a4.js","js/build/sortablejs.982d79d6.js","js/build/vue-resize-observer.e788af6d.js","js/build/element-sea.c283d284.js","js/build/deepmerge.cecf392e.js","js/build/resize-observer-polyfill.37526d89.js","js/build/throttle-debounce.7c3948b2.js","js/build/babel-helper-vue-jsx-merge-props.5ed215c3.js","js/build/normalize-wheel.2a034b9f.js","js/build/async-validator.e7e40052.js","js/build/babel-runtime.4773988a.js","js/build/core-js.314b4a1d.js","js/build/IFrame.ad242f4b.js"]),o={sort:null,mode:null,shared:null},C={components:{UserAvatarTip:k,UserSelect:$,FilePreview:L,DrawerOverlay:v,FileContent:x},directives:{longpress:g},data(){return{packList:[],packShow:!1,loadIng:0,searchKey:"",searchTimeout:null,types:[{value:"folder",label:"\u65B0\u5EFA\u6587\u4EF6\u5939",name:"\u6587\u4EF6\u5939"},{value:"upload",label:"\u4E0A\u4F20\u6587\u4EF6",name:null,divided:!0},{value:"updir",label:"\u4E0A\u4F20\u6587\u4EF6\u5939",name:null},{value:"document",label:"\u6587\u672C",name:"\u6587\u672C",divided:!0},{value:"drawio",label:"\u56FE\u8868",name:"\u56FE\u8868"},{value:"mind",label:"\u601D\u7EF4\u5BFC\u56FE",name:"\u5BFC\u56FE"},{value:"word",label:"Word \u6587\u6863",name:"Word",divided:!0},{value:"excel",label:"Excel \u5DE5\u4F5C\u8868",name:"Excel"},{value:"ppt",label:"PPT \u6F14\u793A\u6587\u7A3F",name:"PPT"}],tableMode:"",hideShared:!1,columns:[],shareShow:!1,shareInfo:{id:0,type:"all",userid:0,permission:1},shareList:[],shareLoad:0,sendFileId:0,sendData:[],linkShow:!1,linkData:{},linkLoad:0,fileShow:!1,fileInfo:{permission:-1},uploadDir:!1,uploadIng:0,uploadShow:!1,uploadList:[],uploadFormat:[],uploadAccept:"",uploadCover:!1,contextMenuItem:{},contextMenuVisible:!1,contextMenuStyles:{top:0,left:0},shearIds:[],selectIds:[],dialogDrag:!1,pasteShow:!1,pasteFile:[],pasteItem:[]}},async beforeRouteEnter(e,i,t){o.sort=await $A.IDBJson("cacheFileSort"),o.mode=await $A.IDBString("fileTableMode"),o.shared=await $A.IDBBoolean("fileHideShared"),t()},created(){this.tableMode=o.mode,this.hideShared=o.shared,this.columns=[{type:"selection",width:50,align:"right"},{title:this.$L("\u6587\u4EF6\u540D"),key:"name",minWidth:300,sortable:!0,render:(e,{row:i})=>{let t=[];if(!/^\d+$/.test(i.id))return t.push(e("Input",{props:{elementId:"input_"+i.id,value:i.newname,autofocus:!0,disabled:!!i._load,parser:this.onParser},style:{width:"auto"},on:{"on-change":a=>{i.newname=a.target.value},"on-blur":()=>{const a=this.fileLists.find(({id:r})=>r==i.id);a&&(a.newname=i.newname,this.onBlur(a))},"on-enter":()=>{const a=this.fileLists.find(({id:r})=>r==i.id);a&&(a.newname=i.newname,this.onEnter(a))}}})),e("div",{class:"file-nbox"},[e("div",{class:`no-dark-before file-name file-icon ${i.type}`},t)]);{t.push(e("QuickEdit",{props:{value:i.name,autoEdit:!!i._edit,clickOutSide:!1,parser:this.onParser},on:{"on-edit-change":l=>{const d=this.fileLists.find(({id:c})=>c==i.id);d&&setTimeout(()=>{this.setEdit(d.id,l)},100)},"on-update":(l,d)=>{const c=this.fileLists.find(({id:p})=>p==i.id);c&&c._edit===!0&&(c.newname=l,this.onEnter(c)),d()}}},[e("AutoTip",{props:{placement:"top"}},$A.getFileName(i))]));const a=[];i.share?i.userid!=this.userId?a.push(e("UserAvatar",{props:{userid:i.userid,size:20}})):a.push(e("i",{class:"taskfont",domProps:{innerHTML:"&#xe757;"}})):this.isParentShare&&a.push(e("UserAvatar",{props:{userid:i.created_id,size:20}},[i.created_id!=i.userid?e("p",[e("strong",this.$L("\u6210\u5458\u521B\u5EFA\u4E8E")+": "+i.created_at)]):e("p",this.$L("\u6240\u6709\u8005\u521B\u5EFA\u4E8E")+": "+i.created_at)]));const r=this.shearIds.includes(i.id)?" shear":"",n=i.share?" share":"";return e("div",{class:`file-nbox${r}`,attrs:{"data-id":i.id}},[e("div",{class:`no-dark-before file-name file-icon ${i.type}${n}`},t),a])}}},{title:this.$L("\u5927\u5C0F"),key:"size",width:110,resizable:!0,sortable:!0,render:(e,{row:i})=>i.type=="folder"?e("div","-"):e("AutoTip",$A.bytesToSize(i.size))},{title:this.$L("\u7C7B\u578B"),key:"type",width:110,resizable:!0,sortable:!0,render:(e,{row:i})=>{let t=this.types.find(({value:s,name:a})=>s==i.type&&a);return t?e("AutoTip",this.$L(t.name)):e("div",(i.ext||i.type).toUpperCase())}},{title:this.$L("\u6240\u6709\u8005"),key:"userid",width:130,resizable:!0,sortable:!0,render:(e,{row:i})=>e("UserAvatar",{props:{size:18,userid:i.userid,showIcon:!1,showName:!0}})},{title:this.$L("\u6700\u540E\u4FEE\u6539"),key:"updated_at",width:168,resizable:!0,sortable:!0}].map(e=>(e.key===o.sort.key&&(e.sortType=o.sort.order),e))},mounted(){this.uploadAccept=this.uploadFormat.map(e=>"."+e).join(",")},activated(){this.getFileList()},computed:{...f(["systemConfig","userIsAdmin","userInfo","fileLists","wsOpenNum","windowWidth","filePackLists"]),pid(){const{folderId:e}=this.$route.params;return parseInt(/^\d+$/.test(e)?e:0)},fid(){const{fileId:e}=this.$route.params;return parseInt(/^\d+$/.test(e)?e:0)},actionUrl(){return $A.apiUrl("file/content/upload?pid="+this.pid+"&cover="+(this.uploadCover?1:0))},headers(){return{fd:$A.getSessionStorageString("userWsFd"),token:this.userToken}},shareAlready(){let e=this.shareList?this.shareList.map(({userid:i})=>i):[];return this.shareInfo.userid&&e.push(this.shareInfo.userid),e},fileList(){const{fileLists:e,searchKey:i,hideShared:t,pid:s,selectIds:a,userId:r}=this;return $A.cloneJSON(m.exports.sortBy(e.filter(l=>t&&l.userid!=r&&l.created_id!=r?!1:i?l.name.indexOf(i)!==-1:l.pid==s),l=>(l.type=="folder"?"a":"b")+l.name)).map(l=>(l._checked=a.includes(l.id),l))},hasShareFile(){const{fileLists:e,userId:i}=this;return e.findIndex(t=>t.share&&t.userid!=i)!==-1},shearFirst(){const{fileLists:e,shearIds:i}=this;return i.length===0?null:e.find(t=>t.id==i[0])},navigator(){let{pid:e,fileLists:i}=this,t=[];for(;e>0;){let s=i.find(({id:a,permission:r})=>a==e&&r>-1);s?(t.unshift(s),e=s.pid):e=0}return t},isPreview(){return this.windowPortrait&&this.fileInfo.type!="document"||this.fileInfo.permission===0},isParentShare(){const{navigator:e}=this;return!!e.find(({share:i})=>i)},pasteTitle(){const{pasteItem:e}=this;let i=e.find(({type:s})=>s=="image"),t=e.find(({type:s})=>s!="image");return i&&t?"\u4E0A\u4F20\u6587\u4EF6/\u56FE\u7247":i?"\u4E0A\u4F20\u56FE\u7247":"\u4E0A\u4F20\u6587\u4EF6"},pasteWrapperClass(){return this.pasteItem.find(({type:e})=>e!=="image")?["multiple"]:[]},tableHeight(){return this.windowHeight-150},compressedSownloadDisabled(){var e;return!!((e=this.fileList)!=null&&e.find(i=>i._checked&&i.permission<1))},maxSize(){var e;return(e=this.systemConfig)!=null&&e.file_upload_limit?this.systemConfig.file_upload_limit*1024:1024e3},showBtnText(){return this.windowWidth>600}},watch:{pid(){this.searchKey="",this.selectIds=[],this.getFileList()},fid(){this.openFileJudge()},tableMode(e){$A.IDBSave("fileTableMode",e)},hideShared(e){$A.IDBSave("fileHideShared",e)},fileShow(e){e||(this.browseFile(0),this.windowPortrait&&$A.onBlur(!0))},navigator:{handler(){this.$nextTick(e=>{this.$refs[`nav_${this.pid}`]&&$A.scrollToView(this.$refs[`nav_${this.pid}`][0],!1)})},immediate:!0},selectIds:{handler(e){e.length>0&&(this.shearIds=[])},deep:!0},shearIds:{handler(e){e.length>0&&(this.selectIds=[])},deep:!0},wsOpenNum(e){e<=1||(this.wsOpenTimeout&&clearTimeout(this.wsOpenTimeout),this.wsOpenTimeout=setTimeout(()=>{this.$route.name=="manage-file"&&this.getFileList()},5e3))},filePackLists:{handler(){this.updatePackProgress()},deep:!0}},methods:{getFileList(){this.$route.name==="manage-file"&&(this.loadIng++,this.$store.dispatch("getFiles",this.pid).then(async()=>{this.loadIng--,this.openFileJudge(),this.shakeFile(this.$route.params.shakeId),await $A.IDBSet("fileFolderId",this.pid)}).catch(({msg:e})=>{this.loadIng--,$A.modalError({content:e,onOk:()=>{this.browseFolder(0)}})}))},addFile(e){if(e){if(e=="upload"){this.uploadDir=!1,this.$refs.fileUpload.handleClick();return}else if(e=="updir"){this.uploadDir=!0,this.$refs.dirUpload.handleClick();return}}else return;let i=$A.randomString(8);this.fileLists.push({_edit:!0,pid:this.pid,id:i,type:e,name:"",userid:this.userId,newname:this.$L("\u672A\u547D\u540D")}),this.autoBlur(i)},handleLongpress(e,i){const t=$A.getAttr(i,"data-id"),s=this.fileList.find(a=>a.id==t);!s||this.handleRightClick(e,s)},handleContextmenu(e){this.windowLandscape&&this.handleRightClick(e)},handleRightClick(e,i,t){this.contextMenuItem=$A.isJson(i)?i:{},this.contextMenuVisible&&this.handleClickContextMenuOutside(),this.$nextTick(()=>{const a=this.$refs.fileWrapper.getBoundingClientRect();this.contextMenuStyles={left:`${e.clientX-a.left}px`,top:`${e.clientY-a.top}px`},t===!0&&(this.contextMenuStyles.top=`${e.target.clientHeight+e.target.offsetTop-5}px`),this.contextMenuVisible=!0})},browseFolder(e,i=null){if(e>0){if(this.pid==e&&this.fid==0&&i){this.shakeFile(i);return}this.goForward({name:"manage-file",params:{folderId:e,fileId:null,shakeId:i}})}else this.searchKey="",this.goForward({name:"manage-file"})},browseFile(e){e>0?this.goForward({name:"manage-file",params:{folderId:this.pid,fileId:e}}):this.browseFolder(this.pid)},openFileJudge(){if(this.$route.name!=="manage-file"){this.fileShow=!1;return}if(this.fid<=0){this.fileShow=!1;return}const e=this.fileList.find(({id:i})=>i===this.fid);if(!e){this.fileShow=!1;return}if(this.$Electron||this.$isEEUiApp){this.openFileSingle(e);return}this.fileInfo=e,this.fileShow=!0},openFileSingle(e){const i=`/single/file/${e.id}`;this.$Electron?this.$store.dispatch("openChildWindow",{name:`file-${e.id}`,path:i,userAgent:"/hideenOfficeTitle/",force:!1,config:{title:$A.getFileName(e),titleFixed:!0,parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)},webPreferences:{nodeIntegrationInSubFrames:e.type==="drawio"}}):this.$isEEUiApp?this.$store.dispatch("openAppChildPage",{pageType:"app",pageTitle:$A.getFileName(e),url:"web.js",params:{titleFixed:!0,allowAccess:!0,url:$A.rightDelete(window.location.href,window.location.hash)+`#${i}`}}):window.open($A.mainUrl(i.substring(1))),this.browseFile(0)},clickRow(e,i){if(this.contextMenuVisible){this.handleClickContextMenuOutside();return}i.type=="selection"?this.dropFile(e,"select"):this.dropFile(e,"open")},handleContextMenu(e,i){this.handleRightClick(i,this.fileLists.find(({id:t})=>t===e.id)||{})},handleContextClick(e){$A.leftExists(e,"new:")?this.addFile($A.leftDelete(e,"new:")):this.dropFile(this.contextMenuItem,e)},handleClickContextMenuOutside(){this.contextMenuVisible=!1},handleVisibleChangeMenu(e){let i=this.fileLists.find(({_highlight:t})=>!!t);i&&this.$set(i,"_highlight",!1),e&&this.contextMenuItem.id&&this.$set(this.contextMenuItem,"_highlight",!0)},dropFile(e,i){switch(i){case"open":case"openCheckMenu":if(i==="openCheckMenu"&&this.contextMenuVisible||this.fileList.findIndex(s=>s._edit===!0)>-1||e._load)return;if(e.type=="folder"){this.browseFolder(e.id);return}if(e.image_url){const s=this.fileList.filter(({image_url:a})=>!!a);if(s.length>0){const a=s.findIndex(({id:n})=>e.id===n),r=s.map(n=>n.image_width?{src:n.image_url,width:n.image_width,height:n.image_height}:n.image_url);this.$store.dispatch("previewImage",{index:a,list:r});return}}this.browseFile(e.id);break;case"upperFolder":this.searchKey="",this.browseFolder(e.pid,e.id);break;case"select":let t=this.selectIds.findIndex(s=>s==e.id);t>-1?this.selectIds.splice(t,1):this.selectIds.push(e.id);break;case"rename":this.setEdit(e.id,!0),this.autoBlur(e.id);break;case"copy":this.$store.dispatch("call",{url:"file/copy",data:{id:e.id}}).then(({data:s,msg:a})=>{$A.messageSuccess(a),this.$store.dispatch("saveFile",s)}).catch(({msg:s})=>{$A.modalError(s)});break;case"shear":this.shearIds=[e.id];break;case"shearSelect":this.shearIds=$A.cloneJSON(this.selectIds);break;case"send":this.sendFileId=e.id,this.sendData=[],this.$refs.sendFile.onSelection();break;case"share":this.shareInfo={id:e.id,type:"all",userid:e.userid,permission:1},this.shareList=[],this.shareShow=!0,this.getShare();break;case"outshare":$A.modalConfirm({content:"\u4F60\u786E\u5B9A\u8981\u9000\u51FA\u3010"+e.name+"\u3011\u5171\u4EAB\u6210\u5458\u5417\uFF1F",loading:!0,onOk:()=>new Promise((s,a)=>{this.$store.dispatch("call",{url:"file/share/out",data:{id:e.id}}).then(({msg:r})=>{s(r),this.$store.dispatch("forgetFile",e.id)}).catch(({msg:r})=>{a(r)})})});break;case"link":this.linkData={id:e.id,name:e.name},this.linkShow=!0,this.linkGet();break;case"download":if(!e.ext)return;$A.modalConfirm({title:"\u4E0B\u8F7D\u6587\u4EF6",content:`${e.name}.${e.ext} (${$A.bytesToSize(e.size)})`,okText:"\u7ACB\u5373\u4E0B\u8F7D",onOk:()=>{this.$store.dispatch("downUrl",$A.apiUrl(`file/content?id=${e.id}&down=yes`))}});break;case"downloadzip":this.downloadZipFile([e.id]);break;case"delete":this.deleteFile([e.id]);break}},onSendFile(){return new Promise((e,i)=>{if(this.sendData.length===0){$A.messageError("\u8BF7\u9009\u62E9\u8F6C\u53D1\u5BF9\u8BDD\u6216\u6210\u5458"),i();return}const t=this.sendData.filter(a=>$A.leftExists(a,"d:")).map(a=>a.replace("d:","")),s=this.sendData.filter(a=>!$A.leftExists(a,"d:"));this.$store.dispatch("call",{url:"dialog/msg/sendfileid",data:{dialogids:t,userids:s,file_id:this.sendFileId}}).then(({data:a,msg:r})=>{this.$store.dispatch("saveDialogMsg",a.msgs),this.$store.dispatch("updateDialogLastMsg",a.msgs),$A.messageSuccess(r),e()}).catch(({msg:a})=>{$A.modalError(a),i()})})},linkGet(e){this.linkLoad++,this.$store.dispatch("call",{url:"file/link",data:{id:this.linkData.id,refresh:e===!0?"yes":"no"}}).then(({data:i})=>{this.linkData=Object.assign(i,{id:this.linkData.id,name:this.linkData.name}),this.linkCopy()}).catch(({msg:i})=>{this.linkShow=!1,$A.modalError(i)}).finally(i=>{this.linkLoad--})},linkCopy(){!this.linkData.url||(this.linkFocus(),this.copyText(this.linkData.url))},linkFocus(){this.$nextTick(e=>{this.$refs.linkInput.focus({cursor:"all"})})},shearTo(){if(this.shearIds.length!=0){if(this.isParentShare){const e=this.fileLists.find(({id:i,share:t})=>t&&this.shearIds.includes(i));if(e){$A.modalError(`${e.name} \u5F53\u524D\u6B63\u5728\u5171\u4EAB\uFF0C\u65E0\u6CD5\u79FB\u52A8\u5230\u53E6\u4E00\u4E2A\u5171\u4EAB\u6587\u4EF6\u5939\u5185`);return}}this.$store.dispatch("call",{url:"file/move",data:{ids:this.shearIds,pid:this.pid}}).then(({data:e,msg:i})=>{$A.messageSuccess(i),this.shearIds=[],this.$store.dispatch("saveFile",e)}).catch(({msg:e})=>{$A.modalError(e)})}},deleteFile(e){if(e.length===0)return;const i=this.fileLists.find(r=>r.id==e[0])||{};let s=!e.find(r=>this.fileLists.find(n=>n.type!="folder"&&n.id==r))?"\u6587\u4EF6\u5939":"\u6587\u4EF6",a=`\u3010${i.name}\u3011\u7B49${e.length}\u4E2A${s}`;e.length===1&&(a=`\u3010${i.name}\u3011${s}`),$A.modalConfirm({title:"\u5220\u9664"+s,content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664"+a+"\u5417\uFF1F",loading:!0,onOk:()=>new Promise((r,n)=>{this.$store.dispatch("call",{url:"file/remove",data:{ids:e}}).then(({msg:l})=>{r(l),this.$store.dispatch("forgetFile",e),this.selectIds=this.selectIds.filter(d=>!e.includes(d))}).catch(({msg:l})=>{n(l)})})})},packPercentageParse(e){return parseInt(e,10)},packClear(){this.packList=this.packList.filter(e=>e.status!=="finished"),this.packShow=!1},async startPack(e){this.packList.push(Object.assign(e,{status:"packing",percentage:0})),this.uploadShow=!1,this.packShow=!0},updatePackProgress(){this.packList.forEach(e=>{const i=this.filePackLists.find(({name:t})=>t==e.name);if(i){if(typeof e.percentage=="number"&&e.percentage>=100)return;e.percentage=Math.max(1,i.progress),e.percentage>=100&&(e.status="finished")}})},downloadZipFile(e){if(e.length===0)return;const i=this.fileLists.find(({id:r})=>r===e[0])||{},s=!e.some(r=>this.fileLists.some(({type:n,id:l})=>n!=="folder"&&l===r))?"\u6587\u4EF6\u5939":"\u6587\u4EF6",a=e.length===1?`\u3010${i.name}\u3011${s}`:`\u3010${i.name}\u3011\u7B49${e.length}\u4E2A${s}`;$A.modalConfirm({title:"\u6253\u5305\u4E0B\u8F7D",content:`\u4F60\u786E\u5B9A\u8981\u6253\u5305\u4E0B\u8F7D${a}\u5417\uFF1F`,okText:"\u786E\u5B9A",onOk:()=>{if(this.packList.find(({status:n})=>n==="packing")){$A.messageWarning("\u8BF7\u7B49\u5F85\u6253\u5305\u5B8C\u6210");return}const r=this.$L(`\u6253\u5305\u4E0B\u8F7D${a}`);this.$store.dispatch("call",{url:"file/download/pack",data:{ids:e,name:r}}).then(({data:n})=>{this.startPack(n)}).catch(({msg:n})=>{$A.modalError(n)})}})},autoBlur(e){this.$nextTick(()=>{if(this.$refs["input_"+e])this.$refs["input_"+e][0].focus({cursor:"all"});else if(document.getElementById("input_"+e)){const i=document.getElementById("input_"+e),t=i.value.length;i.focus(),i.setSelectionRange(0,t)}})},onParser(e){return e.replace(/[\\\/:*?\"<>|]/g,"")},onBlur(e){this.fileLists.find(({id:i,_edit:t})=>i==e.id&&!t)||this.onEnter(e)},onKeyup(e,i){e.keyCode===13?this.onEnter(i):e.keyCode===27&&(!/^\d+$/.test(i.id)?(i.newname="",this.$store.dispatch("forgetFile",i.id)):(this.setLoad(i.id,!1),this.setEdit(i.id,!1)))},onEnter(e){const i=!/^\d+$/.test(e.id);if(!e.newname){i?this.$store.dispatch("forgetFile",e.id):this.setEdit(e.id,!1);return}if(e.newname==e.name){this.setEdit(e.id,!1);return}e._load||(this.setLoad(e.id,!0),this.$store.dispatch("call",{url:"file/add",data:{id:i?0:e.id,pid:e.pid,name:e.newname,type:e.type},spinner:2e3}).then(({data:t,msg:s})=>{$A.messageSuccess(s),this.setLoad(e.id,!1),this.setEdit(e.id,!1),this.$store.dispatch("saveFile",t),i&&(this.$store.dispatch("forgetFile",e.id),this.shakeFile(t.id))}).catch(({msg:t})=>{$A.modalError(t),this.setLoad(e.id,!1),i&&this.$store.dispatch("forgetFile",e.id)}))},setEdit(e,i){const t=this.$store.state.fileLists.find(({id:s})=>s==e);t&&(this.$set(t,"_edit",i),i&&this.$set(t,"newname",t.name))},setLoad(e,i){const t=this.$store.state.fileLists.find(({id:s})=>s==e);t&&this.$set(t,"_load",i)},onSearchFocus(){this.$nextTick(()=>{this.$refs.searchInput.focus({cursor:"end"})})},onSearchChange(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchKey.trim()!=""&&(this.searchTimeout=setTimeout(()=>{this.loadIng++,this.$store.dispatch("searchFiles",this.searchKey.trim()).then(()=>{this.loadIng--}).catch(()=>{this.loadIng--})},600))},getShare(){this.shareLoad++,this.$store.dispatch("call",{url:"file/share",data:{id:this.shareInfo.id}}).then(({data:e})=>{e.id==this.shareInfo.id&&(this.shareList=e.list.map(i=>(i._permission=i.permission,i)))}).catch(({msg:e})=>{this.shareShow=!1,$A.modalError(e)}).finally(e=>{this.shareLoad--})},onShare(e=!1){if(this.shareInfo.type==="all"&&(this.shareInfo.userids=[0]),this.shareInfo.userids.length==0){$A.messageWarning("\u8BF7\u9009\u62E9\u5171\u4EAB\u6210\u5458");return}this.shareLoad++,this.$store.dispatch("call",{url:"file/share/update",data:Object.assign(this.shareInfo,{force:e===!0?1:0})}).then(({data:i,msg:t})=>{$A.messageSuccess(t),this.$store.dispatch("saveFile",i),this.$set(this.shareInfo,"userids",[]),this.getShare()}).catch(({ret:i,msg:t})=>{i===-3001?$A.modalConfirm({content:"\u6B64\u6587\u4EF6\u5939\u5185\u5DF2\u6709\u5171\u4EAB\u6587\u4EF6\u5939\uFF0C\u5B50\u6587\u4EF6\u7684\u5171\u4EAB\u72B6\u6001\u5C06\u88AB\u53D6\u6D88\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",onOk:()=>{this.onShare(!0)}}):$A.modalError(t)}).finally(i=>{this.shareLoad--})},upShare(e,i=!1){e.loading!==!0&&(e.loading=!0,this.$store.dispatch("call",{url:"file/share/update",data:{id:this.shareInfo.id,userids:[e.userid],permission:e.permission,force:i===!0?1:0}}).then(({data:t,msg:s})=>{if(e.loading=!1,e._permission=e.permission,$A.messageSuccess(s),this.$store.dispatch("saveFile",t),e.permission===-1){let a=this.shareList.findIndex(({userid:r})=>r==e.userid);a>-1&&this.shareList.splice(a,1)}}).catch(({ret:t,msg:s})=>{e.loading=!1,t===-3001?$A.modalConfirm({content:"\u6B64\u6587\u4EF6\u5939\u5185\u5DF2\u6709\u5171\u4EAB\u6587\u4EF6\u5939\uFF0C\u5B50\u6587\u4EF6\u7684\u5171\u4EAB\u72B6\u6001\u5C06\u88AB\u53D6\u6D88\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",onOk:()=>{this.upShare(e,!0)},onCancel:()=>{e.permission=e._permission}}):(e.permission=e._permission,$A.modalError(s))}))},uploadData(e){const i=$A.getObject(e,"response.data");if($A.isArray(i))return i[0];if($A.isJson(i))return i},uploadName(e){const i=this.uploadData(e);if(!i)return e.name;const t=i.full_name||e.name;return i.overwrite?`<em class="overwrite">[${this.$L("\u66FF\u6362")}]</em> ${t}`:t},uploadClick(e){const i=this.uploadData(e);!i||this.browseFolder(i.pid,i.id)},handleTableSort({key:e,order:i}){$A.IDBSave("cacheFileSort",["asc","desc"].includes(i)?{key:e,order:i}:{})},handleTableSelect(e){this.selectIds=e.map(i=>i.id)},clearSelect(){this.selectIds=[]},clearShear(){this.shearIds=[]},shakeFile(e){!e||this.$nextTick(i=>{const t=$A(this.$el).find(`[data-id="${e}"]`);t.length>0&&($A.scrollIntoViewIfNeeded(t[0]),$A(t[0]).addClass("common-shake"),setTimeout(s=>$A(t[0]).removeClass("common-shake"),800))})},pasteDragNext(e,i){let t=i==="drag"?e.dataTransfer.files:e.clipboardData.files;t=Array.prototype.slice.call(t),t.length>0&&(e.preventDefault(),this.pasteFile=[],this.pasteItem=[],t.some(s=>{const a={type:$A.getMiddle(s.type,null,"/"),name:s.name,size:s.size,result:null};if(a.type==="image"){const r=new FileReader;r.readAsDataURL(s),r.onload=({target:n})=>{a.result=n.result,this.pasteFile.push(s),this.pasteItem.push(a),this.pasteShow=!0}}else this.pasteFile.push(s),this.pasteItem.push(a),this.pasteShow=!0}))},filePasteDrag(e,i){if(this.dialogDrag=!1,$A.dataHasFolder(i==="drag"?e.dataTransfer:e.clipboardData)){e.preventDefault(),$A.modalWarning(`\u6682\u4E0D\u652F\u6301${i==="drag"?"\u62D6\u62FD":"\u7C98\u8D34"}\u6587\u4EF6\u5939\uFF0C\u8BF7\u624B\u52A8\u4E0A\u4F20\u6587\u4EF6\u5939\u3002`);return}this.pasteDragNext(e,i)},fileDragOver(e,i){let t=this.__dialogDrag=$A.randomString(8);if(!e)setTimeout(()=>{t===this.__dialogDrag&&(this.dialogDrag=e)},150);else{if(i.dataTransfer.effectAllowed==="move")return;this.dialogDrag=!0}},pasteSend(){if(this.__paste_send_index)return;this.__paste_send_index=1,setTimeout(()=>{this.__paste_send_index=0},300);const e=[];this.pasteFile.some(i=>{e.find(t=>t===i.name)||(e.push(i.name),this.$refs.fileUpload.upload(i))})},fileBeforeClose(){return new Promise(e=>{if(!this.$refs.fileContent){e();return}if(this.$refs.fileContent.equalContent){e();return}$A.modalConfirm({content:"\u4FEE\u6539\u7684\u5185\u5BB9\u5C1A\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u8981\u653E\u5F03\u4FEE\u6539\u5417\uFF1F",cancelText:"\u53D6\u6D88",okText:"\u653E\u5F03",onOk:()=>{e()}})})},uploadUpdate(e){e.forEach(i=>{let t=this.uploadList.findIndex(({uid:s})=>s==i.uid);t>-1?this.uploadList.splice(t,1,i):this.uploadList.unshift(i)})},uploadClear(){this.uploadList=this.uploadList.filter(({status:e})=>e!=="finished"),this.$refs.fileUpload.clearFiles(),this.$refs.dirUpload.clearFiles()},uploadPercentageParse(e){return parseInt(e,10)},handleProgress(e,i,t){i._uploadIng===void 0&&(i._uploadIng=!0,this.uploadIng++),this.uploadUpdate(t)},handleSuccess(e,i,t){this.uploadIng--,this.uploadUpdate(t),e.ret===1?this.$store.dispatch("saveFile",e.data):$A.modalWarning({title:"\u4E0A\u4F20\u5931\u8D25",content:"\u6587\u4EF6 "+i.name+" \u4E0A\u4F20\u5931\u8D25\uFF0C"+e.msg})},handleError(e,i,t){this.uploadIng--,this.uploadUpdate(t)},handleFormatError(e){this.uploadDir||$A.modalWarning({title:"\u6587\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E",content:"\u6587\u4EF6 "+e.name+" \u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u4EC5\u652F\u6301\u4E0A\u4F20\uFF1A"+this.uploadFormat.join(",")})},handleMaxSize(e){$A.modalWarning({title:"\u8D85\u51FA\u6587\u4EF6\u5927\u5C0F\u9650\u5236",content:"\u6587\u4EF6 "+e.name+" \u592A\u5927\uFF0C\u4E0D\u80FD\u8D85\u8FC7\uFF1A"+$A.bytesToSize(this.maxSize*1024)+"\u3002"})},handleBeforeUpload(e){return this.uploadCover=!1,this.uploadDir?(this.handleUploadNext(),!0):new Promise(i=>{this.fileList.findIndex(t=>$A.getFileName(t)===e.name)>-1?$A.modalConfirm({wait:!0,title:"\u6587\u4EF6\u5DF2\u5B58\u5728",content:"\u6587\u4EF6 "+e.name+" \u5DF2\u5B58\u5728\uFF0C\u662F\u5426\u66FF\u6362\uFF1F",cancelText:"\u4FDD\u7559\u4E24\u8005",okText:"\u66FF\u6362",closable:!0,onOk:()=>{this.uploadCover=!0,this.handleUploadNext(),i()},onCancel:t=>{t&&(this.handleUploadNext(),i())}}):(this.handleUploadNext(),i())})},handleUploadNext(){this.uploadShow=!0,this.packShow=!1}}},h={};var b=_(C,w,I,!1,S,null,null,null);function S(e){for(let i in h)this[i]=h[i]}var fe=function(){return b.exports}();export{fe as default};
