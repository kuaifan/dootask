import{n as o,_ as n}from"./app.1016ff74.js";import{I as r}from"./IFrame.bf8c198a.js";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"single-file-task"},[i("PageTitle",{attrs:{title:e.title}}),e.loadIng>0?i("Loading"):e.isWait?e._e():[e.isType("md")?i("MDPreview",{attrs:{initialValue:e.fileDetail.content.content}}):e.isType("text")?i("TEditor",{attrs:{value:e.fileDetail.content.content,height:"100%",readOnly:""}}):e.isType("drawio")?i("Drawio",{attrs:{title:e.fileDetail.name,readOnly:""},model:{value:e.fileDetail.content,callback:function(l){e.$set(e.fileDetail,"content",l)},expression:"fileDetail.content"}}):e.isType("mind")?i("Minder",{attrs:{value:e.fileDetail.content,readOnly:""}}):e.isType("code")?i("AceEditor",{staticClass:"view-editor",attrs:{ext:e.fileDetail.ext,readOnly:""},model:{value:e.fileDetail.content.content,callback:function(l){e.$set(e.fileDetail.content,"content",l)},expression:"fileDetail.content.content"}}):e.isType("office")?i("OnlyOffice",{attrs:{code:e.officeCode,documentKey:e.documentKey,readOnly:""},model:{value:e.officeContent,callback:function(l){e.officeContent=l},expression:"officeContent"}}):e.isType("preview")?i("IFrame",{staticClass:"preview-iframe",attrs:{src:e.previewUrl}}):i("div",{staticClass:"no-support"},[e._v(e._s(e.$L("\u4E0D\u652F\u6301\u5355\u72EC\u67E5\u770B\u6B64\u6D88\u606F")))])]],2)},c=[];const d=()=>n(()=>import("./preview.ad72cc47.js"),["js/build/preview.ad72cc47.js","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css"]),f=()=>n(()=>import("./TEditor.3e624f3c.js"),["js/build/TEditor.3e624f3c.js","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css","js/build/ImgUpload.8ed9b082.js"]),_=()=>n(()=>import("./AceEditor.8b924140.js"),["js/build/AceEditor.8b924140.js","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css"]),u=()=>n(()=>import("./OnlyOffice.67cedcc9.js"),["js/build/OnlyOffice.67cedcc9.js","js/build/OnlyOffice.a5dfbde1.css","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css","js/build/IFrame.bf8c198a.js"]),p=()=>n(()=>import("./Drawio.8e3fa535.js"),["js/build/Drawio.8e3fa535.js","js/build/Drawio.fc5c6326.css","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css","js/build/IFrame.bf8c198a.js"]),m=()=>n(()=>import("./Minder.ffa1b30d.js"),["js/build/Minder.ffa1b30d.js","js/build/Minder.f2273bdb.css","js/build/IFrame.bf8c198a.js","js/build/app.1016ff74.js","js/build/app.1b8fddf5.css"]),v={components:{IFrame:r,AceEditor:_,TEditor:f,MDPreview:d,OnlyOffice:u,Drawio:p,Minder:m},data(){return{loadIng:0,isWait:!1,fileDetail:{}}},mounted(){},watch:{$route:{handler(){this.getInfo()},immediate:!0}},computed:{fileId(){const{fileId:e}=this.$route.params;return parseInt(/^\d+$/.test(e)?e:0)},title(){const{name:e}=this.fileDetail;return e||"Loading..."},isType(){const{fileDetail:e}=this;return function(t){return e.file_mode==t}},officeContent(){return{id:this.fileDetail.id||0,type:this.fileDetail.ext,name:this.title}},officeCode(){return"taskFile_"+this.fileDetail.id},previewUrl(){const{name:e,key:t}=this.fileDetail.content;return $A.apiUrl(`../online/preview/${e}?key=${t}`)}},methods:{getInfo(){this.fileId<=0||(setTimeout(e=>{this.loadIng++},600),this.isWait=!0,this.$store.dispatch("call",{url:"project/task/filedetail",data:{file_id:this.fileId}}).then(({data:e})=>{this.fileDetail=e}).catch(({msg:e})=>{$A.modalError({content:e,onOk:()=>{this.$Electron&&window.close()}})}).finally(e=>{this.loadIng--,this.isWait=!1}))},documentKey(){return new Promise(e=>{this.$store.dispatch("call",{url:"project/task/filedetail",data:{file_id:this.fileId,only_update_at:"yes"}}).then(({data:t})=>{e(`${t.id}-${$A.Time(t.update_at)}`)}).catch(()=>{e(0)})})}}},a={};var h=o(v,s,c,!1,D,null,null,null);function D(e){for(let t in a)this[t]=a[t]}var T=function(){return h.exports}();export{T as default};
