import{n as r,U as m}from"./app.267f43a2.js";import{U as h}from"./tip.133279ce.js";import{R as v}from"./ReportEdit.9777f192.js";import{R as _}from"./ReportDetail.3489e37d.js";import{D as $}from"./index.1e2af562.js";import{m as f}from"./vuex.cc7cb26e.js";var g=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"team-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u56E2\u961F\u7BA1\u7406"))+" "),e("div",{staticClass:"title-zoom",on:{click:function(a){t.minBox=!t.minBox}}},[t.minBox?e("i",{staticClass:"taskfont"},[t._v("\uE7D4")]):e("i",{staticClass:"taskfont"},[t._v("\uE7D3")])]),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"management-box",class:{"min-box":t.minBox}},[e("div",{staticClass:"management-department"},[e("ul",[e("li",{class:["level-1",t.departmentSelect===0?"active":""],on:{click:function(a){return t.onSelectDepartment(0)}}},[e("i",{staticClass:"taskfont department-icon"},[t._v("\uE766")]),e("div",{staticClass:"department-title"},[t._v(t._s(t.$L("\u9ED8\u8BA4\u90E8\u95E8")))]),e("EDropdown",{attrs:{size:"medium",trigger:"click"},on:{command:t.onOpDepartment}},[e("i",{staticClass:"taskfont department-menu",on:{click:function(a){a.stopPropagation()}}},[t._v("\uE6E9")]),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("EDropdownItem",{attrs:{command:"add_0"}},[e("div",[t._v(t._s(t.$L("\u6DFB\u52A0\u5B50\u90E8\u95E8")))])])],1)],1)],1),t._l(t.departmentList,function(a){return e("li",{key:a.id,class:[`level-${a.level}`,t.departmentSelect===a.id?"active":""],on:{click:function(i){return t.onSelectDepartment(a.id)}}},[e("UserAvatarTip",{staticClass:"department-icon",attrs:{userid:a.owner_userid,size:20}},[e("p",[e("strong",[t._v(t._s(t.$L("\u90E8\u95E8\u8D1F\u8D23\u4EBA")))])])]),e("div",{staticClass:"department-title"},[t._v(t._s(a.name))]),e("EDropdown",{attrs:{size:"medium",trigger:"click"},on:{command:t.onOpDepartment}},[e("i",{staticClass:"taskfont department-menu",on:{click:function(i){i.stopPropagation()}}},[t._v("\uE6E9")]),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a.level<=2?e("EDropdownItem",{attrs:{command:`add_${a.id}`}},[e("div",[t._v(t._s(t.$L("\u6DFB\u52A0\u5B50\u90E8\u95E8")))])]):t._e(),e("EDropdownItem",{attrs:{command:`edit_${a.id}`}},[e("div",[t._v(t._s(t.$L("\u7F16\u8F91")))])]),e("EDropdownItem",{attrs:{command:`del_${a.id}`}},[e("div",{staticStyle:{color:"#f00"}},[t._v(t._s(t.$L("\u5220\u9664")))])])],1)],1)],1)})],2),e("div",{staticClass:"department-buttons"},[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:function(a){return t.onShowDepartment(null)}}},[t._v(t._s(t.$L("\u65B0\u5EFA\u90E8\u95E8")))])],1)]),e("div",{staticClass:"management-user",style:t.userStyle},[e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u5173\u952E\u8BCD"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{placeholder:t.$L("\u90AE\u7BB1\u3001\u6635\u79F0\u3001\u804C\u4F4D"),clearable:""},model:{value:t.keys.key,callback:function(a){t.$set(t.keys,"key",a)},expression:"keys.key"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u8EAB\u4EFD"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.identity,callback:function(a){t.$set(t.keys,"identity",a)},expression:"keys.identity"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u5168\u90E8")))]),e("Option",{attrs:{value:"admin"}},[t._v(t._s(t.$L("\u7BA1\u7406\u5458")))]),e("Option",{attrs:{value:"noadmin"}},[t._v(t._s(t.$L("\u975E\u7BA1\u7406\u5458")))]),e("Option",{attrs:{value:"temp"}},[t._v(t._s(t.$L("\u4E34\u65F6\u5E10\u53F7")))]),e("Option",{attrs:{value:"notemp"}},[t._v(t._s(t.$L("\u975E\u4E34\u65F6\u5E10\u53F7")))])],1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u5728\u804C\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5728\u804C")},model:{value:t.keys.disable,callback:function(a){t.$set(t.keys,"disable",a)},expression:"keys.disable"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u5728\u804C")))]),e("Option",{attrs:{value:"yes"}},[t._v(t._s(t.$L("\u79BB\u804C")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8")))])],1)],1)]),t.checkinMac?e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("MAC\u5730\u5740"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{placeholder:t.$L("MAC\u5730\u5740"),clearable:""},model:{value:t.keys.checkin_mac,callback:function(a){t.$set(t.keys,"checkin_mac",a)},expression:"keys.checkin_mac"}})],1)]):e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u90AE\u7BB1\u8BA4\u8BC1"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.email_verity,callback:function(a){t.$set(t.keys,"email_verity",a)},expression:"keys.email_verity"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u5168\u90E8")))]),e("Option",{attrs:{value:"yes"}},[t._v(t._s(t.$L("\u5DF2\u90AE\u7BB1\u8BA4\u8BC1")))]),e("Option",{attrs:{value:"no"}},[t._v(t._s(t.$L("\u672A\u90AE\u7BB1\u8BA4\u8BC1")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"bottom","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])]),e("Modal",{attrs:{title:t.$L(t.departmentData.id>0?"\u4FEE\u6539\u90E8\u95E8":"\u65B0\u5EFA\u90E8\u95E8"),"mask-closable":!1},model:{value:t.departmentShow,callback:function(a){t.departmentShow=a},expression:"departmentShow"}},[e("Form",{ref:"addProject",attrs:{model:t.departmentData,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[e("FormItem",{attrs:{prop:"name",label:t.$L("\u90E8\u95E8\u540D\u79F0")}},[e("Input",{attrs:{type:"text",placeholder:t.$L("\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0")},model:{value:t.departmentData.name,callback:function(a){t.$set(t.departmentData,"name",a)},expression:"departmentData.name"}})],1),e("FormItem",{attrs:{prop:"parent_id",label:t.$L("\u4E0A\u7EA7\u90E8\u95E8")}},[e("Select",{attrs:{disabled:t.departmentParentDisabled,placeholder:t.$L("\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8")},model:{value:t.departmentData.parent_id,callback:function(a){t.$set(t.departmentData,"parent_id",a)},expression:"departmentData.parent_id"}},[e("Option",{attrs:{value:0}},[t._v(t._s(t.$L("\u9ED8\u8BA4\u90E8\u95E8")))]),t._l(t.departmentList,function(a,i){return a.parent_id==0&&a.id!=t.departmentData.id?e("Option",{key:i,attrs:{value:a.id,label:a.name}},[t._v("\xA0\xA0\xA0\xA0"+t._s(a.name))]):t._e()})],2),t.departmentParentDisabled?e("div",{staticClass:"form-tip",staticStyle:{"margin-bottom":"-16px"}},[t._v(t._s(t.$L("\u542B\u6709\u5B50\u90E8\u95E8\u65E0\u6CD5\u4FEE\u6539\u4E0A\u7EA7\u90E8\u95E8")))]):t._e()],1),e("FormItem",{attrs:{prop:"owner_userid",label:t.$L("\u90E8\u95E8\u8D1F\u8D23\u4EBA")}},[e("UserSelect",{attrs:{"multiple-max":1,title:t.$L("\u8BF7\u9009\u62E9\u90E8\u95E8\u8D1F\u8D23\u4EBA")},model:{value:t.departmentData.owner_userid,callback:function(a){t.$set(t.departmentData,"owner_userid",a)},expression:"departmentData.owner_userid"}})],1),t.departmentData.id==0?[e("Divider",{attrs:{orientation:"left"}},[t._v(t._s(t.$L("\u7FA4\u7EC4\u8BBE\u7F6E")))]),e("FormItem",{attrs:{prop:"dialog_group",label:t.$L("\u90E8\u95E8\u7FA4\u804A")}},[e("RadioGroup",{model:{value:t.departmentData.dialog_group,callback:function(a){t.$set(t.departmentData,"dialog_group",a)},expression:"departmentData.dialog_group"}},[e("Radio",{attrs:{label:"new"}},[t._v(t._s(t.$L("\u521B\u5EFA\u90E8\u95E8\u7FA4")))]),e("Radio",{attrs:{label:"use"}},[t._v(t._s(t.$L("\u4F7F\u7528\u73B0\u6709\u7FA4")))])],1)],1),t.departmentData.dialog_group==="use"?e("FormItem",{attrs:{prop:"dialog_useid",label:t.$L("\u9009\u62E9\u7FA4\u7EC4")}},[e("Select",{attrs:{filterable:"","remote-method":t.dialogRemote,placeholder:t.$L("\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u7FA4"),loading:t.dialogLoad},model:{value:t.departmentData.dialog_useid,callback:function(a){t.$set(t.departmentData,"dialog_useid",a)},expression:"departmentData.dialog_useid"}},t._l(t.dialogList,function(a,i){return e("Option",{key:i,attrs:{value:a.id,label:a.name}},[e("div",{staticClass:"team-department-add-dialog-group"},[e("div",{staticClass:"dialog-name"},[t._v(t._s(a.name))]),e("UserAvatar",{attrs:{userid:a.owner_id,size:20}})],1)])}),1),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u4EC5\u652F\u6301\u9009\u62E9\u4E2A\u4EBA\u7FA4\u8F6C\u4E3A\u90E8\u95E8\u7FA4")))])],1):t._e()]:t._e()],2),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.departmentShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.departmentLoading>0},on:{click:t.onSaveDepartment}},[t._v(t._s(t.$L(t.departmentData.id>0?"\u4FDD\u5B58":"\u65B0\u5EFA")))])],1)],1),e("Modal",{attrs:{title:t.$L("\u4FEE\u6539\u7B7E\u5230MAC\u5730\u5740")},model:{value:t.checkinMacEditShow,callback:function(a){t.checkinMacEditShow=a},expression:"checkinMacEditShow"}},[e("Form",{attrs:{model:t.checkinMacEditData,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[e("Alert",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"error"}},[t._v(t._s(t.$L(`\u6B63\u5728\u8FDB\u884C\u5E10\u53F7\u3010ID:${t.checkinMacEditData.userid}\uFF0C${t.checkinMacEditData.nickname}\u3011MAC\u5730\u5740\u4FEE\u6539\u3002`)))]),e("Row",{staticClass:"team-department-checkin-item"},[e("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u8BBE\u5907MAC\u5730\u5740")))]),e("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u5907\u6CE8")))])],1),t._l(t.checkinMacEditData.checkin_macs,function(a,i){return e("Row",{key:i,staticClass:"team-department-checkin-item"},[e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{maxlength:20,placeholder:t.$L("\u8BF7\u8F93\u5165\u8BBE\u5907MAC\u5730\u5740"),clearable:""},on:{"on-clear":function(n){return t.delCheckinDatum(i)}},model:{value:a.mac,callback:function(n){t.$set(a,"mac",n)},expression:"item.mac"}})],1),e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{maxlength:100,placeholder:t.$L("\u5907\u6CE8")},model:{value:a.remark,callback:function(n){t.$set(a,"remark",n)},expression:"item.remark"}})],1)],1)}),e("Button",{attrs:{type:"default",icon:"md-add"},on:{click:t.addCheckinDatum}},[t._v(t._s(t.$L("\u6DFB\u52A0\u8BBE\u5907")))])],2),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.checkinMacEditShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.checkinMacEditLoading>0},on:{click:function(a){return t.operationUser(t.checkinMacEditData,!0)}}},[t._v(t._s(t.$L("\u786E\u5B9A\u4FEE\u6539")))])],1)],1),e("Modal",{attrs:{title:t.$L("\u4FEE\u6539\u90E8\u95E8")},model:{value:t.departmentEditShow,callback:function(a){t.departmentEditShow=a},expression:"departmentEditShow"}},[e("Form",{attrs:{model:t.departmentEditData,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[e("Alert",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"error"}},[t._v(t._s(t.$L(`\u6B63\u5728\u8FDB\u884C\u5E10\u53F7\u3010ID:${t.departmentEditData.userid}\uFF0C${t.departmentEditData.nickname}\u3011\u90E8\u95E8\u4FEE\u6539\u3002`)))]),e("FormItem",{attrs:{label:t.$L("\u4FEE\u6539\u90E8\u95E8")}},[e("Select",{attrs:{multiple:"","multiple-max":10,placeholder:t.$L("\u7559\u7A7A\u4E3A\u9ED8\u8BA4\u90E8\u95E8")},model:{value:t.departmentEditData.department,callback:function(a){t.$set(t.departmentEditData,"department",a)},expression:"departmentEditData.department"}},t._l(t.departmentList,function(a,i){return e("Option",{key:i,attrs:{value:a.id}},[t._v(t._s(a.name))])}),1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.departmentEditShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.departmentEditLoading>0},on:{click:function(a){return t.operationUser(t.departmentEditData,!0)}}},[t._v(t._s(t.$L("\u786E\u5B9A\u4FEE\u6539")))])],1)],1),e("Modal",{attrs:{title:t.$L("\u64CD\u4F5C\u79BB\u804C")},model:{value:t.disableShow,callback:function(a){t.disableShow=a},expression:"disableShow"}},[e("Form",{attrs:{model:t.disableData,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[e("Alert",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"error"}},[t._v(t._s(t.$L(`\u6B63\u5728\u8FDB\u884C\u5E10\u53F7\u3010ID:${t.disableData.userid}\uFF0C${t.disableData.nickname}\u3011\u79BB\u804C\u64CD\u4F5C\u3002`)))]),e("FormItem",{attrs:{label:t.$L("\u79BB\u804C\u65F6\u95F4")}},[e("DatePicker",{ref:"disableTime",staticStyle:{width:"100%"},attrs:{editable:!1,placeholder:t.$L("\u9009\u62E9\u79BB\u804C\u65F6\u95F4"),options:t.disableOptions,format:"yyyy/MM/dd HH:mm",type:"datetime"},model:{value:t.disableData.disable_time,callback:function(a){t.$set(t.disableData,"disable_time",a)},expression:"disableData.disable_time"}})],1),e("FormItem",{attrs:{label:t.$L("\u4EA4\u63A5\u4EBA")}},[e("UserSelect",{attrs:{"disabled-choice":[t.disableData.userid],"multiple-max":1,title:t.$L("\u9009\u62E9\u4EA4\u63A5\u4EBA")},model:{value:t.disableData.transfer_userid,callback:function(a){t.$set(t.disableData,"transfer_userid",a)},expression:"disableData.transfer_userid"}}),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L(`${t.disableData.nickname} \u8D1F\u8D23\u7684\u90E8\u95E8\u3001\u9879\u76EE\u3001\u4EFB\u52A1\u548C\u6587\u4EF6\u5C06\u79FB\u4EA4\u7ED9\u4EA4\u63A5\u4EBA\uFF1B\u540C\u65F6\u9000\u51FA\u6240\u6709\u7FA4\uFF08\u5982\u679C\u662F\u7FA4\u4E3B\u5219\u8F6C\u8BA9\u7ED9\u4EA4\u63A5\u4EBA\uFF09`)))])],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.disableShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Poptip",{staticStyle:{"margin-left":"8px"},attrs:{confirm:"",placement:"bottom","ok-text":t.$L("\u786E\u5B9A"),"cancel-text":t.$L("\u53D6\u6D88"),transfer:""},on:{"on-ok":function(a){return t.operationUser(t.disableData,!0)}}},[e("div",{attrs:{slot:"title"},slot:"title"},[e("p",[t._v(t._s(t.$L("\u6CE8\u610F\uFF1A\u79BB\u804C\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF01")))])]),e("Button",{attrs:{type:"primary",loading:t.disableLoading>0}},[t._v(t._s(t.$L("\u786E\u5B9A\u79BB\u804C")))])],1)],1)],1)],1)},k=[];const y={name:"TeamManagement",components:{UserAvatarTip:h,UserSelect:m},props:{checkinMac:{type:Boolean,default:!1}},data(){return{loadIng:0,minBox:!1,minWidth:0,keys:{},keyIs:!1,keyDisable:!1,columns:[{title:"ID",key:"userid",width:80,render:(t,{row:s,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",s.userid)])},{title:this.$L("\u90AE\u7BB1"),key:"email",minWidth:160,render:(t,{row:s})=>{const e=[t("AutoTip",s.email)],{email_verity:a,identity:i,disable_at:n,is_principal:u}=s;return a&&e.push(t("Icon",{props:{type:"md-mail"}})),u&&e.push(t("Tag",{props:{color:"blue"}},this.$L("\u8D1F\u8D23\u4EBA"))),i.includes("ldap")&&e.push(t("Tag",{props:{color:"orange"}},"LDAP")),i.includes("admin")&&e.push(t("Tag",{props:{color:"warning"}},this.$L("\u7BA1\u7406\u5458"))),i.includes("temp")&&e.push(t("Tag",{props:{color:"success"}},this.$L("\u4E34\u65F6"))),i.includes("disable")&&e.push(t("Tooltip",{props:{content:this.$L("\u79BB\u804C\u65F6\u95F4")+": "+n}},[t("Tag",{props:{color:"error"}},this.$L("\u79BB\u804C"))])),t("div",{class:"team-email"},e)}},{title:this.$L("\u7535\u8BDD"),key:"tel",minWidth:80,render:(t,{row:s})=>t("QuickEdit",{props:{value:s.tel},on:{"on-update":(e,a)=>{this.operationUser({userid:s.userid,tel:e},!0).finally(a)}}},[t("AutoTip",s.tel||"-")])},{title:this.$L("\u6635\u79F0"),key:"nickname",minWidth:80,render:(t,{row:s})=>t("QuickEdit",{props:{value:s.nickname_original},on:{"on-update":(e,a)=>{this.operationUser({userid:s.userid,nickname:e},!0).finally(a)}}},[t("AutoTip",s.nickname_original||"-")])},{title:this.$L("\u804C\u4F4D/\u804C\u79F0"),key:"profession",minWidth:80,render:(t,{row:s})=>t("QuickEdit",{props:{value:s.profession},on:{"on-update":(e,a)=>{this.operationUser({userid:s.userid,profession:e},!0).finally(a)}}},[t("AutoTip",s.profession||"-")])},{title:this.$L("\u90E8\u95E8"),key:"department",minWidth:80,render:(t,{row:s})=>{let e=[];if(s.department.some(a=>{const i=this.departmentList.find(n=>n.id==a);i&&e.push(i.name)}),e.length===0)return t("div",this.$L("\u9ED8\u8BA4\u90E8\u95E8"));{const a=[];return a.push(t("span",{domProps:{title:e[0]}},e[0])),e.length>1&&(e=e.splice(1),a.push(t("ETooltip",[t("div",{slot:"content",domProps:{innerHTML:e.join("<br/>")}}),t("div",{class:"department-tag-num"},` +${e.length}`)]))),t("div",{class:"team-table-department-warp"},a)}}},{key:"line_at",width:168,renderHeader:t=>{const s=[];return this.keyDisable&&(s.push(t("span",{style:{color:"#f90"}},this.$L("\u79BB\u804C\u65F6\u95F4"))),s.push(t("span","/"))),s.push(t("span",this.$L("\u6700\u540E\u5728\u7EBF"))),t("div",s)},render:(t,s)=>{const{line_at:e,disable_at:a}=s.row,i=[];return this.keyDisable&&i.push(t("div",{style:{color:"#f90"}},a||"-")),i.push(t("div",e||"-")),t("div",i)}},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(t,s)=>{const e=s.row.identity,a=[];e.includes("admin")?a.push(t("EDropdownItem",{props:{command:"clearadmin"}},[t("div",this.$L("\u53D6\u6D88\u7BA1\u7406\u5458"))])):a.push(t("EDropdownItem",{props:{command:"setadmin"}},[t("div",this.$L("\u8BBE\u4E3A\u7BA1\u7406\u5458"))])),e.includes("temp")?a.push(t("EDropdownItem",{props:{command:"cleartemp"}},[t("div",this.$L("\u53D6\u6D88\u4E34\u65F6\u8EAB\u4EFD"))])):a.push(t("EDropdownItem",{props:{command:"settemp"}},[t("div",this.$L("\u8BBE\u4E3A\u4E34\u65F6\u5E10\u53F7"))])),a.push(t("EDropdownItem",{props:{command:"email"}},[t("div",this.$L("\u4FEE\u6539\u90AE\u7BB1"))])),a.push(t("EDropdownItem",{props:{command:"password"}},[t("div",this.$L("\u4FEE\u6539\u5BC6\u7801"))])),this.checkinMac&&a.push(t("EDropdownItem",{props:{command:"checkin_mac"}},[t("div",this.$L("\u4FEE\u6539MAC"))])),a.push(t("EDropdownItem",{props:{command:"department"}},[t("div",this.$L("\u4FEE\u6539\u90E8\u95E8"))])),e.includes("disable")?a.push(t("EDropdownItem",{props:{command:"cleardisable"},style:{color:"#f90"}},[t("div",this.$L("\u6062\u590D\u5E10\u53F7\uFF08\u5DF2\u79BB\u804C\uFF09"))])):a.push(t("EDropdownItem",{props:{command:"setdisable"},style:{color:"#f90"}},[t("div",this.$L("\u64CD\u4F5C\u79BB\u804C"))])),a.push(t("EDropdownItem",{props:{command:"delete"},style:{color:"red"}},[t("div",this.$L("\u5220\u9664"))]));const i=t("EDropdown",{props:{size:"small",trigger:"click"},on:{command:n=>{this.dropUser(n,s.row)}}},[t("Button",{props:{type:"primary",size:"small"},style:{fontSize:"12px"}},this.$L("\u64CD\u4F5C")),t("EDropdownMenu",{slot:"dropdown"},[a])]);return t("TableAction",{props:{column:s.column}},[i])}}],list:[],page:1,pageSize:20,total:0,noText:"",checkinMacEditShow:!1,checkinMacEditLoading:0,checkinMacEditData:{},departmentEditShow:!1,departmentEditLoading:0,departmentEditData:{},disableShow:!1,disableLoading:0,disableData:{},disableOptions:{shortcuts:[{text:"12:00",value(){return $A.Date($A.formatDate("Y-m-d 12:00:00"))},onClick:t=>{t.handlePickSuccess()}},{text:"17:00",value(){return $A.Date($A.formatDate("Y-m-d 17:00:00"))},onClick:t=>{t.handlePickSuccess()}},{text:"18:00",value(){return $A.Date($A.formatDate("Y-m-d 18:00:00"))},onClick:t=>{t.handlePickSuccess()}},{text:"19:00",value(){return $A.Date($A.formatDate("Y-m-d 19:00:00"))},onClick:t=>{t.handlePickSuccess()}},{text:this.$L("\u73B0\u5728"),value(){return new Date},onClick:t=>{t.handlePickSuccess()}}]},departmentShow:!1,departmentLoading:0,departmentSelect:-1,departmentData:{id:0,name:"",parent_id:0,owner_userid:[],dialog_group:"new",dialog_useid:0},departmentList:[],dialogLoad:!1,dialogList:[],nullCheckinDatum:{mac:"",remark:""}}},created(){this.checkinMac&&this.columns.splice(5,0,{title:this.$L("MAC\u5730\u5740"),key:"checkin_mac",minWidth:80,render:(t,{row:s})=>{let e=$A.cloneJSON(s.checkin_macs||[]);if(e.length===0)return t("div","-");{const a=n=>n.remark?`${n.mac} (${n.remark})`:n.mac,i=[];return i.push(t("AutoTip",a(e[0]))),e.length>1&&(e=e.splice(1),i.push(t("ETooltip",[t("div",{slot:"content",domProps:{innerHTML:e.map(n=>a(n)).join("<br/>")}}),t("div",{class:"department-tag-num"},` +${e.length}`)]))),t("div",{class:"team-table-department-warp"},i)}}})},mounted(){this.getLists(),this.getDepartmentLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))},departmentSelect(){this.setPage(1)},windowPortrait:{handler(t){this.minBox=t},immediate:!0},minBox:{handler(){this.$nextTick(t=>{this.$el&&this.$el.clientWidth>0&&(this.minWidth=this.$el.clientWidth)})},immediate:!0}},computed:{departmentParentDisabled(){return!!(this.departmentData.id>0&&this.departmentList.find(({parent_id:t})=>t==this.departmentData.id))},userStyle({minWidth:t,windowPortrait:s}){const e={};return t>0&&s&&(e.minWidth=t-40+"px"),e}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.keyDisable=this.keys.disable==="yes";let t=$A.cloneJSON(this.keys);this.departmentSelect>-1&&(t=Object.assign(t,{department:this.departmentSelect})),this.$store.dispatch("call",{url:"users/lists",data:{keys:t,get_checkin_mac:this.checkinMac?1:0,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:s})=>{this.page=s.current_page,this.total=s.total,this.list=s.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6210\u5458"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(s=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},dropUser(t,s){switch(t){case"settemp":$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u5C06\u3010ID:${s.userid}\uFF0C${s.nickname}\u3011\u8BBE\u4E3A\u4E34\u65F6\u5E10\u53F7\u5417\uFF1F\uFF08\u6CE8\uFF1A\u4E34\u65F6\u5E10\u53F7\u9650\u5236\u8BF7\u67E5\u770B\u7CFB\u7EDF\u8BBE\u7F6E\uFF09`,loading:!0,onOk:()=>this.operationUser({userid:s.userid,type:t})});break;case"cleartemp":$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u53D6\u6D88\u3010ID:${s.userid}\uFF0C${s.nickname}\u3011\u4E34\u65F6\u8EAB\u4EFD\u5417\uFF1F`,loading:!0,onOk:()=>this.operationUser({userid:s.userid,type:t})});break;case"email":$A.modalInput({title:"\u4FEE\u6539\u90AE\u7BB1",placeholder:`\u8BF7\u8F93\u5165\u65B0\u7684\u90AE\u7BB1\uFF08${s.email}\uFF09`,onOk:a=>a?this.operationUser({userid:s.userid,email:a}):"\u8BF7\u8F93\u5165\u65B0\u7684\u90AE\u7BB1\u5730\u5740"});break;case"password":$A.modalInput({title:"\u4FEE\u6539\u5BC6\u7801",placeholder:"\u8BF7\u8F93\u5165\u65B0\u7684\u5BC6\u7801",onOk:a=>a?this.operationUser({userid:s.userid,password:a}):"\u8BF7\u8F93\u5165\u65B0\u7684\u5BC6\u7801"});break;case"checkin_mac":this.checkinMacEditData={type:"checkin_macs",userid:s.userid,nickname:s.nickname,checkin_macs:s.checkin_macs},this.checkinMacEditData.checkin_macs.length===0&&this.addCheckinDatum(),this.checkinMacEditShow=!0;break;case"department":let e=[];s.department.some(a=>{const i=this.departmentList.find(n=>n.id==a);i&&e.push(i.owner_userid===s.userid?`${i.name} (${this.$L("\u8D1F\u8D23\u4EBA")})`:i.name)}),this.departmentEditData={type:"department",userid:s.userid,nickname:s.nickname,department:s.department.map(a=>parseInt(a))},this.departmentEditShow=!0;break;case"setdisable":this.disableData={type:"setdisable",userid:s.userid,nickname:s.nickname},this.disableShow=!0;break;case"cleardisable":$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u6062\u590D\u5DF2\u79BB\u804C\u5E10\u53F7\u3010ID:${s.userid}\uFF0C${s.nickname}\u3011\u5417\uFF1F\uFF08\u6CE8\uFF1A\u6B64\u64CD\u4F5C\u4EC5\u6062\u590D\u5E10\u53F7\u72B6\u6001\uFF0C\u65E0\u6CD5\u6062\u590D\u64CD\u4F5C\u79BB\u804C\u65F6\u79FB\u4EA4\u7684\u6570\u636E\uFF09`,loading:!0,onOk:()=>this.operationUser({userid:s.userid,type:t})});break;case"delete":$A.modalInput({title:`\u5220\u9664\u5E10\u53F7\u3010ID:${s.userid}\uFF0C${s.nickname}\u3011`,placeholder:"\u8BF7\u8F93\u5165\u5220\u9664\u539F\u56E0",okText:"\u786E\u5B9A\u5220\u9664",onOk:a=>a?this.operationUser({userid:s.userid,type:t,delete_reason:a}):"\u5220\u9664\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});break;default:this.operationUser({userid:s.userid,type:t},!0);break}},operationUser(t,s){return new Promise((e,a)=>{t.type=="checkin_macs"?this.checkinMacEditLoading++:t.type=="department"?this.departmentEditLoading++:t.type=="setdisable"?this.disableLoading++:this.loadIng++,this.$store.dispatch("call",{url:"users/operation",data:t}).then(({msg:i})=>{$A.messageSuccess(i),this.getLists(),e(),t.type=="checkin_macs"?this.checkinMacEditShow=!1:t.type=="department"?this.departmentEditShow=!1:t.type=="setdisable"&&(this.disableShow=!1)}).catch(({msg:i})=>{s===!0&&$A.modalError(i),this.getLists(),a(i)}).finally(i=>{t.type=="checkin_macs"?this.checkinMacEditLoading--:t.type=="department"?this.departmentEditLoading--:t.type=="setdisable"?this.disableLoading--:this.loadIng--})})},getDepartmentLists(){this.departmentLoading++,this.$store.dispatch("call",{url:"users/department/list"}).then(({data:t})=>{this.departmentList=[],this.generateDepartmentList(t,0,1)}).finally(t=>{this.departmentLoading--})},generateDepartmentList(t,s,e){t.some(a=>{a.parent_id==s&&(this.departmentList.push(Object.assign(a,{level:e+1})),this.generateDepartmentList(t,a.id,e+1))})},onShowDepartment(t){this.departmentData=Object.assign({id:0,name:"",parent_id:0,owner_userid:[],dialog_group:"new"},t||{}),this.departmentShow=!0},onSaveDepartment(){this.departmentLoading++,this.$store.dispatch("call",{url:"users/department/add",data:Object.assign(this.departmentData,{owner_userid:this.departmentData.owner_userid[0]})}).then(({msg:t})=>{$A.messageSuccess(t),this.getDepartmentLists(),this.getLists(),this.departmentShow=!1}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.departmentLoading--})},onSelectDepartment(t){if(this.windowPortrait&&(this.minBox=!0),this.departmentSelect===t){this.departmentSelect=-1;return}this.departmentSelect=t},onOpDepartment(t){if($A.leftExists(t,"add_"))this.onShowDepartment({parent_id:parseInt(t.substr(4))});else if($A.leftExists(t,"edit_")){const s=this.departmentList.find(({id:e})=>e===parseInt(t.substr(5)));s&&this.onShowDepartment(s)}else if($A.leftExists(t,"del_")){const s=this.departmentList.find(({id:e})=>e===parseInt(t.substr(4)));s&&$A.modalConfirm({title:this.$L("\u5220\u9664\u90E8\u95E8"),content:`<div>${this.$L(`\u4F60\u786E\u5B9A\u8981\u5220\u9664\u3010${s.name}\u3011\u90E8\u95E8\u5417\uFF1F`)}</div><div style="color:#f00;font-weight:600">${this.$L("\u6CE8\u610F\uFF1A\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\uFF0C\u90E8\u95E8\u4E0B\u7684\u6210\u5458\u5C06\u79FB\u81F3\u9ED8\u8BA4\u90E8\u95E8\u3002")}</div>`,language:!1,loading:!0,onOk:()=>new Promise((e,a)=>{this.$store.dispatch("call",{url:"users/department/del",data:{id:s.id}}).then(({msg:i})=>{s.id===this.departmentSelect&&(this.departmentSelect=-1),e(i),this.getDepartmentLists()}).catch(({msg:i})=>{a(i)})})})}},dialogRemote(t){t!==""?(this.dialogLoad=!0,this.$store.dispatch("call",{url:"dialog/group/searchuser",data:{key:t}}).then(({data:s})=>{this.dialogList=s.list}).finally(s=>{this.dialogLoad=!1})):this.dialogList=[]},addCheckinDatum(){this.checkinMacEditData.checkin_macs.push($A.cloneJSON(this.nullCheckinDatum))},delCheckinDatum(t){this.checkinMacEditData.checkin_macs.splice(t,1),this.checkinMacEditData.checkin_macs.length===0&&this.addCheckinDatum()}}},l={};var L=r(y,g,k,!1,b,null,null,null);function b(t){for(let s in l)this[s]=l[s]}var X=function(){return L.exports}(),D=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"report-list-wrap"},[e("div",{staticClass:"search-expand"},[e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(a){t.$set(t.keys,"type",a)},expression:"keys.type"}},t._l(t.reportTypeList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}),1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u65F6\u95F4"))+" ")]),e("div",{staticClass:"search-content"},[e("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.keys.created_at,callback:function(a){t.$set(t.keys,"created_at",a)},expression:"keys.created_at"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"expand-button-group"},[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.addReport}},[t._v(t._s(t.$L("\u65B0\u589E\u62A5\u544A")))])],1)]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""}}),e("Page",{attrs:{total:t.listTotal,current:t.listPage,"page-size":t.listPageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},w=[];const S={name:"ReportMy",data(){return{loadIng:0,columns:[{title:this.$L("\u540D\u79F0"),key:"title",minWidth:180,render:(t,{row:s})=>t("AutoTip",s.title)},{title:this.$L("\u7C7B\u578B"),key:"type",align:"center",width:90},{title:this.$L("\u6C47\u62A5\u65F6\u95F4"),key:"created_at",align:"center",width:180},{title:this.$L("\u6C47\u62A5\u5BF9\u8C61"),key:"receives",align:"center",width:90,render:(t,{row:s})=>{if(s.receives.length===0)return t("div","-");const e=[];return s.receives.length<=2?s.receives.some(a=>{e.push(t("UserAvatar",{props:{size:22,userid:a}}))}):(e.push(t("UserAvatar",{props:{size:22,userid:s.receives[0]}})),e.push(t("div",{class:"more-avatar"},`+${s.receives.length-1}`))),t("div",{class:"report-table-avatar"},e)}},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,minWidth:100,render:(t,{column:s,row:e})=>e.id?t("TableAction",{props:{column:s,menu:[{icon:"md-create",action:"edit"},{icon:"md-eye",action:"view"}]},on:{action:a=>{a==="edit"?this.$emit("on-edit",e.id):a==="view"&&this.$emit("on-view",e)}}}):null}],lists:[],listPage:1,listTotal:0,listPageSize:20,noDataText:"\u6570\u636E\u52A0\u8F7D\u4E2D.....",keys:{},keyIs:!1,reportTypeList:[{value:"",label:this.$L("\u5168\u90E8")},{value:"weekly",label:this.$L("\u5468\u62A5")},{value:"daily",label:this.$L("\u65E5\u62A5")}]}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.listPage=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"report/my",data:{keys:this.keys,page:Math.max(this.listPage,1),pagesize:Math.max($A.runNum(this.listPageSize),10)}}).then(({data:t})=>{this.lists=t.data,this.listTotal=t.total,this.noDataText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(({msg:t})=>{$A.messageError(t),this.noDataText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(()=>{this.loadIng--})},setPage(t){this.listPage=t,this.getLists()},setPageSize(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},addReport(){this.$emit("on-edit",0)}}},o={};var x=r(S,D,w,!1,I,null,null,null);function I(t){for(let s in o)this[s]=o[s]}var C=function(){return x.exports}(),E=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"report-list-wrap"},[e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u5173\u952E\u8BCD"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{placeholder:t.$L("\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22"),clearable:""},model:{value:t.keys.key,callback:function(a){t.$set(t.keys,"key",a)},expression:"keys.key"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(a){t.$set(t.keys,"type",a)},expression:"keys.type"}},t._l(t.reportTypeList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}),1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u65F6\u95F4"))+" ")]),e("div",{staticClass:"search-content"},[e("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.keys.created_at,callback:function(a){t.$set(t.keys,"created_at",a)},expression:"keys.created_at"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""},on:{"on-selection-change":t.selectChange}}),e("div",{staticClass:"table-attach"},[e("div",{staticClass:"select-box"},[e("Select",{attrs:{disabled:t.selectIds.length==0,placeholder:t.$L("\u8BF7\u9009\u62E9"),transfer:""},on:{"on-change":function(a){t.groupSelect=!0}},model:{value:t.selectAction,callback:function(a){t.selectAction=a},expression:"selectAction"}},[e("Option",{attrs:{value:"read"}},[t._v(t._s(t.$L("\u6807\u8BB0\u5DF2\u8BFB")))]),e("Option",{attrs:{value:"unread"}},[t._v(t._s(t.$L("\u6807\u8BB0\u672A\u8BFB")))])],1),e("Button",{attrs:{loading:t.loadIng>0,type:"primary",disabled:t.selectAction==""||t.selectIds.length==0},on:{click:t.selectClick}},[t._v(t._s(t.$L("\u6267\u884C")))])],1),e("Page",{attrs:{total:t.listTotal,current:t.listPage,"page-size":t.listPageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)],1)])},A=[];const T={name:"ReportReceive",data(){return{loadIng:0,columns:[{type:"selection",width:50,align:"right"},{title:this.$L("\u6807\u9898"),key:"title",sortable:!0,minWidth:180,render:(t,{row:s})=>{let e=[];const a=s.receives_user.find(({userid:i})=>i==this.userId);return a&&a.pivot.read==0?e.push(t("Tag",{props:{color:"orange"},style:{flexShrink:0}},this.$L("\u672A\u8BFB")),t("AutoTip",s.title)):e.push(t("AutoTip",s.title)),t("div",{style:{display:"flex",alignItems:"center"}},e)}},{title:this.$L("\u7C7B\u578B"),key:"type",sortable:!0,width:90},{title:this.$L("\u63A5\u6536\u65F6\u95F4"),key:"receive_time",align:"center",sortable:!0,width:180},{title:this.$L("\u64CD\u4F5C"),align:"center",width:90,minWidth:90,render:(t,{column:s,row:e})=>e.id?t("TableAction",{props:{column:s,menu:[{icon:"md-eye",action:"view"}]},on:{action:a=>{if(a==="view"){this.$emit("on-view",e);const i=e.receives_user.find(({userid:n})=>n==this.userId);i&&this.$set(i.pivot,"read",1)}}}}):null}],lists:[],listPage:1,listTotal:0,listPageSize:20,noDataText:"\u6570\u636E\u52A0\u8F7D\u4E2D.....",keys:{},keyIs:!1,selectIds:[],selectAction:"",reportTypeList:[{value:"",label:this.$L("\u5168\u90E8")},{value:"weekly",label:this.$L("\u5468\u62A5")},{value:"daily",label:this.$L("\u65E5\u62A5")}]}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.listPage=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"report/receive",data:{keys:this.keys,page:Math.max(this.listPage,1),pagesize:Math.max($A.runNum(this.listPageSize),10)}}).then(({data:t})=>{this.lists=t.data,this.listTotal=t.total,this.noDataText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(({msg:t})=>{$A.messageError(t),this.noDataText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(()=>{this.loadIng--})},setPage(t){this.listPage=t,this.getLists()},setPageSize(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},selectChange(t){this.selectIds=t.map(({id:s})=>s)},selectClick(){if(this.selectIds.length===0){$A.messageWarning("\u8BF7\u9009\u62E9\u7EBF\u8DEF");return}switch(this.selectAction){case"read":case"unread":this.readReport(this.selectIds,this.selectAction);break;default:$A.messageWarning("\u8BF7\u9009\u62E9\u6267\u884C\u65B9\u5F0F");break}},readReport(t,s){const e=s==="read"?"\u6807\u8BB0\u5DF2\u8BFB":"\u6807\u8BB0\u672A\u8BFB";$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u8981\u3010${e}\u3011\u5417\uFF1F`,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A",loading:!0,onOk:()=>new Promise((a,i)=>{this.$store.dispatch("call",{url:"report/mark",data:{id:t,action:s}}).then(({msg:n})=>{a(n),this.getLists(),this.$emit("on-read")}).catch(({msg:n})=>{i(n)})})})}}},c={};var M=r(T,E,A,!1,P,null,null,null);function P(t){for(let s in c)this[s]=c[s]}var O=function(){return M.exports}(),z=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"report"},[e("Tabs",{model:{value:t.reportTabs,callback:function(a){t.reportTabs=a},expression:"reportTabs"}},[e("TabPane",{attrs:{label:t.$L("\u6211\u7684\u6C47\u62A5"),name:"my"}},[t.reportTabs==="my"?e("ReportMy",{ref:"report",on:{"on-view":t.onView,"on-edit":t.onEditReport}}):t._e()],1),e("TabPane",{attrs:{label:t.tabRebder(t.reportUnreadNumber),name:"receive"}},[t.reportTabs==="receive"?e("ReportReceive",{on:{"on-view":t.onView,"on-read":t.onRead}}):t._e()],1)],1),e("DrawerOverlay",{attrs:{placement:"right",size:950,transfer:""},model:{value:t.showDetailDrawer,callback:function(a){t.showDetailDrawer=a},expression:"showDetailDrawer"}},[t.showDetailDrawer?e("ReportDetail",{attrs:{data:t.detailData}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1e3,transfer:""},model:{value:t.showEditDrawer,callback:function(a){t.showEditDrawer=a},expression:"showEditDrawer"}},[t.showEditDrawer?e("ReportEdit",{attrs:{id:t.reportId},on:{saveSuccess:t.saveSuccess}}):t._e()],1)],1)},R=[];const B={name:"Report",components:{DrawerOverlay:$,ReportEdit:v,ReportMy:C,ReportReceive:O,ReportDetail:_},props:{value:{default:"my"}},data(){return{reportTabs:"my",showDetailDrawer:!1,showEditDrawer:!1,detailData:{},reportId:0}},mounted(){this.reportTabs=this.value,this.$isMainElectron&&this.$Electron.listenerOnly("reportSaveSuccess",({data:t,msg:s})=>{$A.messageSuccess(s),this.saveSuccess(t)})},computed:{...f(["reportUnreadNumber"])},watch:{reportTabs(t){this.$emit("input",t)}},methods:{tabRebder(t){return s=>t>0?s("div",[s("span",{class:"navbar-item-content"},this.$L("\u6536\u5230\u7684\u6C47\u62A5")),s("Badge",{class:"manage-box-report",props:{count:t}})]):s("div",[s("span",{class:"navbar-item-content"},this.$L("\u6536\u5230\u7684\u6C47\u62A5"))])},onView(t){if(this.detailData=t,this.$emit("on-read"),this.$Electron){let s={title:t.title,titleFixed:!0,parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)};this.$store.dispatch("openChildWindow",{name:`report-detail-${t.id}`,path:`/single/report/detail/${t.id}`,force:!1,config:s})}else this.showDetailDrawer=!0},onRead(){this.$emit("on-read",0)},onEditReport(t){if(this.$Electron){let s={title:this.$L(t>0?"\u4FEE\u6539\u62A5\u544A":"\u65B0\u589E\u62A5\u544A"),parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)};this.$store.dispatch("openChildWindow",{name:`report-edit-${t}`,path:`/single/report/edit/${t}`,force:!1,config:s})}else this.reportId=t,this.showEditDrawer=!0},saveSuccess(){this.reportId=0,this.reportTabs="my",this.showEditDrawer=!1,this.$refs.report&&this.$refs.report.getLists()}}},d={};var U=r(B,z,R,!1,F,null,null,null);function F(t){for(let s in d)this[s]=d[s]}var Z=function(){return U.exports}(),W=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u7B7E\u5230\u6570\u636E"),"mask-closable":!1},model:{value:t.show,callback:function(a){t.show=a},expression:"show"}},[e("Form",{ref:"export",attrs:{model:t.formData,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u5BFC\u51FA\u6210\u5458")}},[e("UserSelect",{attrs:{"multiple-max":100,"avatar-name":"","show-disable":"",title:t.$L("\u8BF7\u9009\u62E9\u6210\u5458")},model:{value:t.formData.userid,callback:function(a){t.$set(t.formData,"userid",a)},expression:"formData.userid"}}),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6BCF\u6B21\u6700\u591A\u9009\u62E9\u5BFC\u51FA100\u4E2A\u6210\u5458")))])],1),e("FormItem",{attrs:{label:t.$L("\u7B7E\u5230\u65E5\u671F")}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u7B7E\u5230\u65E5\u671F")},model:{value:t.formData.date,callback:function(a){t.$set(t.formData,"date",a)},expression:"formData.date"}}),e("div",{staticClass:"form-tip checkin-export-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(a){t.formData.date=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),e("em",{on:{click:function(a){t.formData.date=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),e("FormItem",{attrs:{label:t.$L("\u73ED\u6B21\u65F6\u95F4")}},[e("TimePicker",{staticStyle:{width:"100%"},attrs:{type:"timerange",format:"HH:mm",placeholder:t.$L("\u8BF7\u9009\u62E9\u73ED\u6B21\u65F6\u95F4")},model:{value:t.formData.time,callback:function(a){t.$set(t.formData,"time",a)},expression:"formData.time"}}),e("div",{staticClass:"form-tip checkin-export-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(a){t.formData.time=["8:30","18:00"]}}},[t._v("8:30-18:00")]),e("em",{on:{click:function(a){t.formData.time=["9:00","18:00"]}}},[t._v("9:00-18:00")]),e("em",{on:{click:function(a){t.formData.time=["9:30","18:00"]}}},[t._v("9:30-18:30")])])],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},j=[];const N={name:"CheckinExport",components:{UserSelect:m},props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{userid:[],date:[],time:[]}}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},methods:{dateShortcuts(t){if(t==="prev")return[$A.getSpecifyDate("\u4E0A\u4E2A\u6708"),$A.getSpecifyDate("\u4E0A\u4E2A\u6708\u7ED3\u675F")];if(t==="this")return[$A.getSpecifyDate("\u672C\u6708"),$A.getSpecifyDate("\u672C\u6708\u7ED3\u675F")]},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"system/checkin/export",data:this.formData}).then(({data:t})=>{this.show=!1,this.$store.dispatch("downUrl",{url:t.url})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},p={};var H=r(N,W,j,!1,Y,null,null,null);function Y(t){for(let s in p)this[s]=p[s]}var tt=function(){return H.exports}();export{tt as C,Z as R,X as T};
