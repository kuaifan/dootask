import{m as l,a as d}from"./vuex.cc7cb26e.js";import{T as c,n as u}from"./app.fe1cd649.js";import"./@micro-zoe.c2e1472d.js";import"./jquery.f44c3c79.js";import"./@babel.43d8d0a5.js";import"./dayjs.aaefe451.js";import"./localforage.bd4872f5.js";import"./markdown-it.6846e2b0.js";import"./entities.797c3e49.js";import"./uc.micro.700527ef.js";import"./mdurl.95c1032c.js";import"./linkify-it.96515e28.js";import"./punycode.50f384b0.js";import"./highlight.js.ab8aeea4.js";import"./markdown-it-link-attributes.e1d5d151.js";import"./@traptitech.64308959.js";import"./vue.296078bd.js";import"./openpgp_hi.15f91b1d.js";import"./axios.6ec123f8.js";import"./le5le-store.d4b5b622.js";import"./vue-router.2d566cd7.js";import"./vue-clipboard2.ad7135d3.js";import"./clipboard.3f21bed6.js";import"./view-design-hi.609f8897.js";import"./vuedraggable.6ea348a4.js";import"./sortablejs.982d79d6.js";import"./vue-resize-observer.e788af6d.js";import"./element-sea.c283d284.js";import"./deepmerge.cecf392e.js";import"./resize-observer-polyfill.37526d89.js";import"./throttle-debounce.7c3948b2.js";import"./babel-helper-vue-jsx-merge-props.5ed215c3.js";import"./normalize-wheel.2a034b9f.js";import"./async-validator.e7e40052.js";import"./babel-runtime.4773988a.js";import"./core-js.314b4a1d.js";var _=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"page-dashboard"},[t("PageTitle",{attrs:{title:s.$L("\u4EEA\u8868\u76D8")}}),s.warningMsg?t("Alert",{staticClass:"dashboard-warning",attrs:{type:"warning","show-icon":""}},[t("span",{on:{click:function(i){return s.goForward({name:"manage-setting-license"})}}},[s._v(s._s(s.warningMsg))])]):s._e(),t("div",{staticClass:"dashboard-wrapper",style:s.wrapperStyle},[t("div",{staticClass:"dashboard-hello"},[s._v(s._s(s.$L("\u6B22\u8FCE\u60A8\uFF0C"+s.userInfo.nickname)))]),s.systemConfig.timezoneDifference?t("div",{staticClass:"dashboard-time"},[t("span",[s._v(s._s(s.$L("\u670D\u52A1\u5668\u65F6\u95F4"))+":")]),t("span",[s._v(s._s(s.$A.daytz().format("YYYY-MM-DD HH:mm:ss")))])]):s._e(),t("div",{staticClass:"dashboard-desc"},[t("span",[s._v(s._s(s.$L("\u4EE5\u4E0B\u662F\u4F60\u5F53\u524D\u7684\u4EFB\u52A1\u7EDF\u8BA1\u6570\u636E")))]),t("transition",{attrs:{name:"dashboard-load"}},[s.loadDashboardTasks?t("div",{staticClass:"dashboard-load"},[t("Loading")],1):s._e()])],1),t("ul",{staticClass:"dashboard-block"},[t("li",{on:{click:function(i){return s.scrollTo("today")}}},[t("div",{staticClass:"block-title"},[s._v(s._s(s.getTitle("today")))]),t("div",{staticClass:"block-data"},[t("div",{staticClass:"block-num"},[s._v(s._s(s.dashboardTask.today_count))]),t("i",{staticClass:"taskfont"},[s._v("\uE6F4")])])]),t("li",{on:{click:function(i){return s.scrollTo("overdue")}}},[t("div",{staticClass:"block-title"},[s._v(s._s(s.getTitle("overdue")))]),t("div",{staticClass:"block-data"},[t("div",{staticClass:"block-num"},[s._v(s._s(s.dashboardTask.overdue_count))]),t("i",{staticClass:"taskfont"},[s._v("\uE603")])])]),t("li",{on:{click:function(i){return s.scrollTo("all")}}},[t("div",{staticClass:"block-title"},[s._v(s._s(s.getTitle("all")))]),t("div",{staticClass:"block-data"},[t("div",{staticClass:"block-num"},[s._v(s._s(s.dashboardTask.all_count))]),t("i",{staticClass:"taskfont"},[s._v("\uE6F9")])])])]),t("Scrollbar",{staticClass:"dashboard-list"},[s._l(s.columns,function(i){return i.list.length>0?[t("div",{ref:`type_${i.type}`,refInFor:!0,staticClass:"dashboard-ref"}),t("div",{staticClass:"dashboard-title",class:{"title-close":i.hidden},on:{click:function(a){return s.onDashboardHidden(i.type)}}},[t("span",[s._v(" "+s._s(i.title)+" "),i.hidden?[s._v(" ("+s._s(i.list.length)+") ")]:s._e()],2),t("i",{staticClass:"taskfont"},[s._v("\uE702")])]),t("ul",{staticClass:"dashboard-ul",class:{"ul-hidden":i.hidden}},s._l(i.list,function(a,n){return t("li",{key:n,class:{complete:a.complete_at},style:a.color?{backgroundColor:a.color}:{},on:{click:function(o){return s.openTask(a)}}},[a.p_name?t("em",{staticClass:"priority-color",style:{backgroundColor:a.p_color}}):s._e(),t("div",{staticClass:"item-select",on:{click:function(o){return o.stopPropagation(),s.openMenu(o,a)}}},[t("i",{staticClass:"taskfont",domProps:{innerHTML:s._s(a.complete_at?"&#xe627;":"&#xe625;")}})]),t("div",{staticClass:"item-title"},[a.flow_item_name?t("span",{class:a.flow_item_status,on:{click:function(o){return o.stopPropagation(),s.openMenu(o,a)}}},[s._v(s._s(a.flow_item_name))]):s._e(),a.sub_top===!0?t("span",[s._v(s._s(s.$L("\u5B50\u4EFB\u52A1")))]):s._e(),a.sub_my&&a.sub_my.length>0?t("span",[s._v("+"+s._s(a.sub_my.length))]):s._e(),s._v(" "+s._s(a.name)+" ")]),a.desc?t("div",{staticClass:"item-icon"},[t("i",{staticClass:"taskfont"},[s._v("\uE71A")])]):s._e(),a.sub_num>0?t("div",{staticClass:"item-icon"},[t("i",{staticClass:"taskfont"},[s._v("\uE71F")]),t("em",[s._v(s._s(a.sub_complete)+"/"+s._s(a.sub_num))])]):s._e(),a.end_at?t("ETooltip",{attrs:{disabled:s.$isEEUiApp||s.windowTouch,content:a.end_at,placement:"right"}},[t("div",{class:["item-icon",a.today?"today":"",a.overdue?"overdue":""]},[t("i",{staticClass:"taskfont"},[s._v("\uE71D")]),t("em",[s._v(s._s(s.expiresFormat(a.end_at)))])])]):s._e()],1)}),0)]:s._e()})],2)],1)],1)},h=[];const p={components:{TaskMenu:c},data(){return{nowTime:$A.dayjs().unix(),nowInter:null,licenseTimer:null,loadIng:0,dashboard:"today",warningMsg:"",hiddenColumns:[]}},activated(){this.$store.dispatch("getTaskForDashboard",600),this.loadInterval(!0),this.loadLicense(!0)},deactivated(){this.$store.dispatch("forgetTaskCompleteTemp",!0),this.loadInterval(!1),this.loadLicense(!1)},computed:{...l(["systemConfig","userInfo","userIsAdmin","cacheTasks","taskCompleteTemps","loadDashboardTasks"]),...d(["dashboardTask","assistTask","transforTasks"]),routeName(){return this.$route.name},columns({hiddenColumns:s}){const e=[];return["today","overdue","all"].some(t=>{let i=this.transforTasks(this.dashboardTask[t]);e.push({type:t,title:this.getTitle(t),hidden:s.includes(t),list:i.sort((a,n)=>$A.dayjs(a.end_at||"2099-12-31 23:59:59")-$A.dayjs(n.end_at||"2099-12-31 23:59:59"))})}),e.push({type:"assist",title:this.getTitle("assist"),hidden:s.includes("assist"),list:this.assistTask.sort((t,i)=>$A.dayjs(t.end_at||"2099-12-31 23:59:59")-$A.dayjs(i.end_at||"2099-12-31 23:59:59"))}),e},total(){const{dashboardTask:s}=this;return s.today_count+s.overdue_count+s.all_count},wrapperStyle({warningMsg:s}){return s?{"max-height":"calc(100% - 50px)"}:null}},watch:{windowActive(s){this.routeName==="manage-dashboard"&&(this.loadInterval(s),this.loadLicense(s),s&&this.$store.dispatch("getTaskForDashboard",600))}},methods:{getTitle(s){switch(s){case"today":return this.$L("\u4ECA\u65E5\u5230\u671F");case"overdue":return this.$L("\u8D85\u671F\u4EFB\u52A1");case"all":return this.$L("\u5F85\u5B8C\u6210\u4EFB\u52A1");case"assist":return this.$L("\u534F\u52A9\u7684\u4EFB\u52A1");default:return""}},scrollTo(s){const e=this.$refs[`type_${s}`];if(e){const t=this.hiddenColumns.indexOf(s);t!==-1&&this.hiddenColumns.splice(t,1),this.$nextTick(i=>{$A.scrollToView(e[0],{behavior:"smooth",inline:"end"})})}},onDashboardHidden(s){const e=this.hiddenColumns.indexOf(s);e===-1?this.hiddenColumns.push(s):this.hiddenColumns.splice(e,1)},openTask(s){this.$store.dispatch("openTask",s)},openMenu(s,e){this.$store.state.taskOperation={event:s,task:e}},expiresFormat(s){return $A.countDownFormat(this.nowTime,s)},loadInterval(s){this.nowInter&&(clearInterval(this.nowInter),this.nowInter=null),s!==!1&&(this.nowInter=setInterval(e=>{this.nowTime=$A.dayjs().unix()},1e3))},loadLicense(s){this.licenseTimer&&(clearTimeout(this.licenseTimer),this.licenseTimer=null),!(s===!1||!this.userIsAdmin)&&(this.licenseTimer=setTimeout(e=>{this.$store.dispatch("call",{url:"system/license",data:{type:"get"}}).then(({data:t})=>{this.warningMsg=t.error.length>0?t.error[0]:""}).catch(t=>{this.warningMsg=""})},1500))}}},r={};var m=u(p,_,h,!1,v,null,null,null);function v(s){for(let e in r)this[e]=r[e]}var Z=function(){return m.exports}();export{Z as default};
