import{m as d,a as f}from"./vuex.cc7cb26e.js";import{n,N as j,U as g,M as P}from"./app.fe1cd649.js";import{C as N,R,T as B}from"./CheckinExport.55a36504.js";import{D as E}from"./index.de3fdb79.js";import{l}from"./le5le-store.d4b5b622.js";import{T as U,a as O,b as z}from"./TaskDetail.fb300021.js";import{m as k}from"./@micro-zoe.c2e1472d.js";import{M as F}from"./MeetingManager.484bdb73.js";import{l as G}from"./longpress.6c9d7403.js";import{D as V}from"./DialogWrapper.ab24beb1.js";import{A as Y}from"./ApproveExport.25ef7d81.js";import{M as K}from"./MicroApps.a25b86de.js";import{n as H}from"./notification-koro1.99b93615.js";import{I as W}from"./ImgUpload.d9d55773.js";import"./jquery.f44c3c79.js";import"./@babel.43d8d0a5.js";import"./dayjs.aaefe451.js";import"./localforage.bd4872f5.js";import"./markdown-it.6846e2b0.js";import"./entities.797c3e49.js";import"./uc.micro.700527ef.js";import"./mdurl.95c1032c.js";import"./linkify-it.96515e28.js";import"./punycode.50f384b0.js";import"./highlight.js.ab8aeea4.js";import"./markdown-it-link-attributes.e1d5d151.js";import"./@traptitech.64308959.js";import"./vue.296078bd.js";import"./openpgp_hi.15f91b1d.js";import"./axios.6ec123f8.js";import"./vue-router.2d566cd7.js";import"./vue-clipboard2.ad7135d3.js";import"./clipboard.3f21bed6.js";import"./view-design-hi.609f8897.js";import"./vuedraggable.6ea348a4.js";import"./sortablejs.982d79d6.js";import"./vue-resize-observer.e788af6d.js";import"./element-sea.c283d284.js";import"./deepmerge.cecf392e.js";import"./resize-observer-polyfill.37526d89.js";import"./throttle-debounce.7c3948b2.js";import"./babel-helper-vue-jsx-merge-props.5ed215c3.js";import"./normalize-wheel.2a034b9f.js";import"./async-validator.e7e40052.js";import"./babel-runtime.4773988a.js";import"./core-js.314b4a1d.js";import"./tip.2ea44d3a.js";import"./ReportEdit.3b7ff280.js";import"./ReportDetail.dc71685b.js";import"./ProjectLog.3db4d7fc.js";import"./TEditor.c8f7ff92.js";import"./tinymce.15f82c9c.js";import"./quill-hi.5f983100.js";import"./parchment.d5c5924e.js";import"./quill-delta.9c20d28a.js";import"./fast-diff.f17881f3.js";import"./lodash.clonedeep.c11ef6f7.js";import"./lodash.isequal.1abdaf11.js";import"./eventemitter3.78b735ad.js";import"./lodash-es.df04b444.js";import"./quill-mention-hi.b64d1fea.js";import"./vue-virtual-scroll-list-hi.7485c393.js";import"./details.bb7e8fb8.js";var X=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"project-archived"},[e("div",{staticClass:"archived-title"},[t._v(" "+t._s(t.$L("\u5F52\u6863\u7684\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(s){t.$set(t.keys,"name",s)},expression:"keys.name"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},J=[];const q={name:"ProjectArchived",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:a,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",a.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:200,render:(t,{row:a})=>t("AutoTip",a.name)},{title:this.$L("\u5F52\u6863\u65F6\u95F4"),key:"archived_at",width:168},{title:this.$L("\u5F52\u6863\u4EBA\u5458"),key:"archived_userid",minWidth:80,render:(t,{row:a})=>a.archived_userid?t("UserAvatar",{props:{userid:a.archived_userid,size:24,showName:!0}}):t("Tag",this.$L("\u7CFB\u7EDF\u81EA\u52A8"))},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.owner_userid}})},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(t,a)=>{const e=[t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u8FD8\u539F\u5F52\u6863\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.recovery(a.row)}}},this.$L("\u8FD8\u539F")),t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u9879\u76EE\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:"8px",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(a.row)}}},this.$L("\u5220\u9664"))];return t("TableAction",{props:{column:a.column}},e)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,archived:"yes",page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},recovery(t){this.list=this.list.filter(({id:a})=>a!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"project/archived",data:{project_id:t.id,type:"recovery"}}).then(()=>{this.getLists(),this.$store.dispatch("getProjectOne",t.id).catch(()=>{})}).catch(({msg:a})=>{$A.modalError(a),this.getLists()}).finally(a=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:a})=>a!=t.id),this.loadIng++,this.$store.dispatch("removeProject",t.id).then(({msg:a})=>{$A.messageSuccess(a),this.getLists()}).catch(({msg:a})=>{$A.modalError(a),this.getLists()}).finally(a=>{this.loadIng--})}}},b={};var Q=n(q,X,J,!1,Z,null,null,null);function Z(t){for(let a in b)this[a]=b[a]}var tt=function(){return Q.exports}(),et=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"project-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u6240\u6709\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(s){t.$set(t.keys,"name",s)},expression:"keys.name"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u56E2\u961F\u9879\u76EE")},model:{value:t.keys.type,callback:function(s){t.$set(t.keys,"type",s)},expression:"keys.type"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u56E2\u961F\u9879\u76EE")))]),e("Option",{attrs:{value:"personal"}},[t._v(t._s(t.$L("\u4E2A\u4EBA\u9879\u76EE")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8\u9879\u76EE")))])],1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u672A\u5F52\u6863")},model:{value:t.keys.status,callback:function(s){t.$set(t.keys,"status",s)},expression:"keys.status"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u672A\u5F52\u6863")))]),e("Option",{attrs:{value:"archived"}},[t._v(t._s(t.$L("\u5DF2\u5F52\u6863")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},at=[];const st={name:"ProjectManagement",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:a,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",a.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:100,render:(t,{row:a})=>{const e=[t("AutoTip",a.name)];return a.archived_at&&e.push(t("Tag",{props:{color:"error"}},this.$L("\u5DF2\u5F52\u6863"))),t("div",{class:"project-name"},e)}},{title:this.$L("\u9879\u76EE\u8FDB\u5EA6"),minWidth:100,render:(t,{row:a})=>{const e=[t("AutoTip",a.task_complete+"/"+a.task_num),t("Progress",{props:{percent:a.task_percent,strokeWidth:5}})];return t("div",{class:"project-percent"},e)}},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.owner_userid}})},{title:this.$L("\u521B\u5EFA\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){let t="team";this.keys.type=="all"?t="all":this.keys.type=="personal"&&(t="personal");let a="no";this.keys.status=="all"?a="all":this.keys.status=="archived"&&(a="yes"),this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,all:1,archived:a,type:t,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:e})=>{this.page=e.current_page,this.total=e.total,this.list=e.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(e=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()}}},y={};var it=n(st,et,at,!1,ot,null,null,null);function ot(t){for(let a in y)this[a]=y[a]}var rt=function(){return it.exports}(),nt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mobile-tabbar"},[t.windowPortrait?e("NetworkException",{attrs:{type:"alert"}}):t._e(),e("ul",{staticClass:"tabbar-box"},t._l(t.navList,function(s){return e("li",{class:{active:t.activeName===s.name},on:{click:function(i){return t.toggleRoute(s.name)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(s.icon)}}),e("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(s.label)))]),s.name==="dashboard"?[t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.all_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.all_count}}):t._e()]:s.name==="dialog"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})]:s.name==="application"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}})]:t._e()],2)}),0)],1)},lt=[];const ct={name:"MobileTabbar",components:{NetworkException:j},data(){return{navList:[{icon:"&#xe6fb;",name:"dashboard",label:"\u4EEA\u8868\u76D8"},{icon:"&#xe6fa;",name:"project",label:"\u9879\u76EE"},{icon:"&#xe6eb;",name:"dialog",label:"\u6D88\u606F"},{icon:"&#xe6b2;",name:"contacts",label:"\u901A\u8BAF\u5F55"},{icon:"&#xe60c;",name:"application",label:"\u5E94\u7528"}]}},computed:{...d(["cacheDialogs","reportUnreadNumber","approveUnreadNumber"]),...f(["dashboardTask"]),routeName(){return this.$route.name},msgUnreadMention(){let t=0,a=0;this.cacheDialogs.some(s=>{t+=$A.getDialogUnread(s,!1),a+=$A.getDialogMention(s)}),t>999&&(t="999+"),a>999&&(a="999+");const e=this.msgTodoTotal;return e?a?`@${a}\xB7${e}`:t?`${t}\xB7${e}`:e:t?a?`${t}\xB7@${a}`:String(t):a?`@${a}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(a=>{t+=$A.getDialogNum(a)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((a,e)=>a+(e.todo_num||0),0);return t>0?(t>999?t="999+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},activeName(){return["manage-calendar","manage-file","manage-setting","manage-application","manage-approve","manage-apps"].includes(this.routeName)?"application":this.routeName==="manage-dashboard"?"dashboard":this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?"project":this.routeName==="manage-messenger"?this.$route.params.dialogAction==="contacts"?"contacts":"dialog":""}},watch:{windowActive(t){t||$A.eeuiAppSendMessage({action:"setBdageNotify",bdage:this.unreadAndOverdue})}},methods:{toggleRoute(t){this.$emit("on-click",t);let a;switch(t){case"project":a={name:"manage-project",params:{projectId:"all"}};break;case"dialog":a={name:"manage-messenger",params:{dialogAction:"dialog"}},this.routeName==="manage-messenger"&&l.Store.set("clickAgainDialog",!0);break;case"contacts":a={name:"manage-messenger",params:{dialogAction:"contacts"}};break;default:a={name:"manage-"+t};break}this.goForward(a)}}},w={};var dt=n(ct,nt,lt,!1,ht,null,null,null);function ht(t){for(let a in w)this[a]=w[a]}var ut=function(){return dt.exports}(),pt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"task-add"},[e("div",{staticClass:"head",class:{empty:t.addData.cascader.length==0,visible:t.cascaderShow}},[e("Cascader",{attrs:{data:t.cascaderData,clearable:!1,placeholder:t.$L("\u8BF7\u9009\u62E9\u9879\u76EE"),"load-data":t.cascaderLoadData,filterable:""},on:{"on-change":t.cascaderChange,"on-input-change":t.cascaderInputChange,"on-visible-change":function(s){t.cascaderShow=!t.cascaderShow}},model:{value:t.addData.cascader,callback:function(s){t.$set(t.addData,"cascader",s)},expression:"addData.cascader"}})],1),e("div",{staticClass:"task-add-form"},[e("div",{staticClass:"title"},[e("Input",{ref:"input",attrs:{type:"textarea",rows:1,autosize:{minRows:1,maxRows:8},maxlength:255,placeholder:t.$L("\u4EFB\u52A1\u63CF\u8FF0"),enterkeyhint:"done"},on:{"on-keydown":t.onKeydown},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1),e("TEditorTask",{staticClass:"desc",attrs:{placeholder:t.$L(t.windowLandscape?"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B...\uFF08\u70B9\u51FB\u53F3\u952E\u4F7F\u7528\u5DE5\u5177\u680F\uFF09":"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B..."),placeholderFull:t.$L("\u8BE6\u7EC6\u63CF\u8FF0...")},model:{value:t.addData.content,callback:function(s){t.$set(t.addData,"content",s)},expression:"addData.content"}}),e("div",{staticClass:"advanced-option",class:{"advanced-open":t.advanced}},[e("Button",{on:{click:function(s){t.advanced=!t.advanced}}},[t._v(t._s(t.$L("\u9AD8\u7EA7\u9009\u9879")))]),e("ul",{staticClass:"advanced-priority"},t._l(t.taskPriority,function(s,i){return e("li",{key:i},[e("ETooltip",{attrs:{disabled:t.$isEEUiApp||t.windowTouch,content:t.taskPriorityContent(s)}},[e("i",{staticClass:"taskfont",style:{color:s.color},domProps:{innerHTML:t._s(t.addData.p_name==s.name?"&#xe61d;":"&#xe61c;")},on:{click:function(o){return t.choosePriority(s)}}})])],1)}),0),t.taskDays>0||t.taskTimeOpen?e("DatePicker",{attrs:{open:t.taskTimeOpen,options:t.timeOptions,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange",placement:"bottom"},on:{"on-change":function(s){return t.taskTimeChange(t.addData)},"on-open-change":t.taskTimeOpenChange},model:{value:t.addData.times,callback:function(s){t.$set(t.addData,"times",s)},expression:"addData.times"}},[e("div",{staticClass:"advanced-time",on:{click:function(s){return t.taskTimeOpenChange(!t.taskTimeOpen)}}},[e("Icon",{attrs:{type:"ios-clock-outline"}}),e("em",{style:t.addData.p_color?{backgroundColor:t.addData.p_color}:{},attrs:{type:"primary"}},[t._v(t._s(t.taskDays))])],1)]):t._e()],1)],1),t.advanced?e("Form",{staticClass:"task-add-advanced",attrs:{"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u8BA1\u5212\u65F6\u95F4")}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(s){return t.taskTimeChange(t.addData)}},model:{value:t.addData.times,callback:function(s){t.$set(t.addData,"times",s)},expression:"addData.times"}})],1),e("FormItem",{attrs:{label:t.$L("\u8D1F\u8D23\u4EBA")}},[e("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:t.addData.owner,callback:function(s){t.$set(t.addData,"owner",s)},expression:"addData.owner"}})],1),e("FormItem",{attrs:{label:t.$L("\u534F\u52A9\u4EBA\u5458")}},[e("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u534F\u52A9\u4EBA\u5458"),"project-id":t.addData.project_id,"disabled-choice":t.addData.owner,"avatar-size":24,border:""},model:{value:t.addData.assist,callback:function(s){t.$set(t.addData,"assist",s)},expression:"addData.assist"}})],1),e("FormItem",[e("div",{staticClass:"visibility-text",attrs:{slot:"label"},on:{click:t.showCisibleDropdown},slot:"label"},[t._v(" "+t._s(t.$L("\u53EF\u89C1\u6027"))+" "),e("i",{staticClass:"taskfont"},[t._v("\uE740")])]),t.addData.visibility_appoint==1||t.addData.visibility_appoint==2?e("div",{ref:"visibilityText",staticClass:"ivu-input task-add-visibility",on:{click:t.showCisibleDropdown}},[t._v(" "+t._s(t.addData.visibility_appoint==1?t.$L("\u9879\u76EE\u4EBA\u5458\u53EF\u89C1"):t.$L("\u4EFB\u52A1\u4EBA\u5458\u53EF\u89C1"))+" ")]):e("UserSelect",{ref:"visibleUserSelectRef",attrs:{"avatar-size":24,title:t.$L("\u9009\u62E9\u6307\u5B9A\u4EBA\u5458"),"project-id":t.addData.project_id,border:""},on:{"on-show-change":t.visibleUserSelectShowChange},model:{value:t.addData.visibility_appointor,callback:function(s){t.$set(t.addData,"visibility_appointor",s)},expression:"addData.visibility_appointor"}})],1),e("EDropdown",{ref:"eDropdownRef",staticClass:"calculate-dropdown",attrs:{trigger:"click",placement:"bottom"},on:{command:t.dropVisible}},[e("div",{staticClass:"calculate-content"}),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("EDropdownItem",{attrs:{command:1}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==1?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u9879\u76EE\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:2}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==2?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:3}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==3?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u6307\u5B9A\u6210\u5458"))+" ")],1)])],1)],1),e("div",{staticClass:"subtasks"},[t.addData.subtasks.length>0?e("div",{staticClass:"sublist"},[e("Row",[e("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u63CF\u8FF0")))]),e("Col",{attrs:{span:"8"}},[t._v(t._s(t.$L("\u8BA1\u5212\u65F6\u95F4")))]),e("Col",{attrs:{span:"4"}},[t._v(t._s(t.$L("\u8D1F\u8D23\u4EBA")))])],1),t._l(t.addData.subtasks,function(s,i){return e("Row",{key:i},[e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{maxlength:255,clearable:""},on:{"on-clear":function(o){return t.addData.subtasks.splice(i,1)}},model:{value:s.name,callback:function(o){t.$set(s,"name",o)},expression:"item.name"}})],1),e("Col",{attrs:{span:"8",title:t.timeTitle(s.times)}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u65F6\u95F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(o){return t.taskTimeChange(s)}},model:{value:s.times,callback:function(o){t.$set(s,"times",o)},expression:"item.times"}})],1),e("Col",{attrs:{span:"4"}},[e("UserSelect",{attrs:{"multiple-max":1,title:t.$L("\u9009\u62E9\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:s.owner,callback:function(o){t.$set(s,"owner",o)},expression:"item.owner"}})],1)],1)})],2):t._e(),e("Input",{class:["enter-input",t.subName==""?"empty":""],attrs:{type:"text",placeholder:t.$L("+ \u8F93\u5165\u5B50\u4EFB\u52A1\uFF0C\u56DE\u8F66\u6DFB\u52A0\u5B50\u4EFB\u52A1")},on:{"on-enter":t.addSubTask},model:{value:t.subName,callback:function(s){t.subName=s},expression:"subName"}})],1)],1):t._e(),e("div",{staticClass:"ivu-modal-footer"},[e("div",{staticClass:"adaption"},[e("Button",{attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("ButtonGroup",{staticClass:"page-manage-add-task-button-group"},[e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAdd}},[t._v(t._s(t.$L("\u6DFB\u52A0\u4EFB\u52A1")))]),e("Dropdown",{attrs:{transfer:""},on:{"on-click":function(s){return t.onAdd(!0)}}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{disabled:t.loadIng>0}},[t._v(t._s(t.$L("\u63D0\u4EA4\u7EE7\u7EED\u6DFB\u52A0")))])],1)],1)],1)],1)]),e("TaskExistTips",{ref:"taskExistTipsRef",on:{onAdd:function(s){return t.onAdd(t.again,!0)}}})],1)},mt=[];const ft={name:"TaskAdd",components:{TEditorTask:U,UserSelect:g,TaskExistTips:O},props:{value:{type:Boolean,default:!1}},data(){return{addData:{cascader:[],name:"",content:"",owner:[],assist:[],project_id:0,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:"",visibility_appoint:1,visibility_appointor:[]},cascaderShow:!1,cascaderData:[],cascaderValue:"",cascaderLoading:0,cascaderAlready:[],advanced:!1,subName:"",taskTimeOpen:!1,timeOptions:{shortcuts:$A.timeOptionShortcuts()},loadIng:0,isMounted:!1,beforeClose:[],again:!1}},async mounted(){this.initCascaderData(),await this.initProjectData(),this.$nextTick(()=>this.$refs.input.focus()),this.isMounted=!0},beforeDestroy(){this.beforeClose.some(t=>{typeof t=="function"&&t()}),this.beforeClose=[]},computed:{...d(["cacheProjects","projectId","cacheColumns","taskPriority"]),taskDays(){const{times:t}=this.addData,a=$A.newDateString(t,"YYYY-MM-DD HH:mm");if(a[0]&&a[1]){const e=Math.ceil($A.dayjs(a[1]).diff(a[0],"day",!0));if(e>0)return e}return 0}},watch:{"addData.owner"(t){this.addData.assist=this.addData.assist.filter(a=>t.indexOf(a)===-1),this.addData.assist.length===0&&t.indexOf(this.userId)===-1&&(this.addData.assist=[this.userId])},"addData.project_id"(t){t>0&&$A.IDBSave("cacheAddTaskProjectId",t)},"addData.column_id"(t){t>0&&$A.IDBSave("cacheAddTaskColumnId",t);const{project_id:a}=this.addData;a&&t?this.$set(this.addData,"cascader",[a,t]):this.$set(this.addData,"cascader",[])}},methods:{initCascaderData(){const t=$A.cloneJSON(this.cacheProjects).sort((a,e)=>a.top_at||e.top_at?$A.dayjs(e.top_at)-$A.dayjs(a.top_at):e.id-a.id);this.cascaderData=t.map(a=>{const e=this.cacheColumns.filter(({project_id:i})=>i==a.id).map(i=>({value:i.id,label:i.name})),s={value:a.id,label:a.name,children:e};return e.length==0&&(s.loading=!1),s})},async initProjectData(){let t=await $A.IDBInt("cacheAddTaskProjectId"),a=this.cacheProjects.find(({id:e})=>e==this.projectId)||this.cacheProjects.find(({id:e})=>e==t)||this.cacheProjects.find(({id:e})=>e>0);if(a){let e=await $A.IDBInt("cacheAddTaskColumnId"),s=this.cacheColumns.find(({project_id:i,id:o})=>i==a.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==a.id);s?(this.addData.project_id=s.project_id,this.addData.column_id=s.id):this.$store.dispatch("getColumns",a.id).then(()=>{s=this.cacheColumns.find(({project_id:i,id:o})=>i==a.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==a.id),s&&(this.addData.project_id=s.project_id,this.addData.column_id=s.id)}).catch(()=>{})}this.taskPriority.length>0&&await this.choosePriority(this.taskPriority[0])},async taskTimeChange(t){const a=$A.newDateString(t.times,"YYYY-MM-DD HH:mm");$A.rightExists(a[0],"00:00")&&$A.rightExists(a[1],"23:59")&&this.$set(t,"times",await this.$store.dispatch("taskDefaultTime",a))},taskTimeOpenChange(t){this.taskTimeOpen=t},timeTitle(t){return t?$A.newDateString(t):null},onKeydown(t){if(t.keyCode===13){if(t.shiftKey)return;t.preventDefault(),this.onAdd()}},addSubTask(){this.subName.trim()!==""&&(this.addData.subtasks.push({name:this.subName.trim(),owner:[this.userId],times:[]}),this.subName="")},taskPriorityContent(t){const a=$A.runNum(t.days);return a<=0?t.name+" ("+this.$L("\u65E0\u65F6\u95F4\u9650\u5236")+")":t.name+" ("+a+this.$L("\u5929")+")"},async choosePriority(t){const a=$A.daytz(),e=$A.runNum(t.days);if(e>0){const s=a.clone().add(e,"day");this.$set(this.addData,"times",await this.$store.dispatch("taskDefaultTime",$A.newDateString([a,s])))}else this.$set(this.addData,"times",[]);this.$set(this.addData,"p_level",t.priority),this.$set(this.addData,"p_name",t.name),this.$set(this.addData,"p_color",t.color)},cascaderLoadData(t,a){t.loading=!0,this.$store.dispatch("getColumns",t.value).then(e=>{t.children=e.map(s=>({value:s.id,label:s.name})),t.loading=!1,a()}).catch(()=>{t.loading=!1,a()})},cascaderChange(t){t[1]&&(this.$set(this.addData,"project_id",t[0]),this.$set(this.addData,"column_id",t[1]))},cascaderInputChange(t){this.cascaderValue=t||"",this.cascaderAlready[this.cascaderValue]!==!0&&(this.cascaderAlready[this.cascaderValue]=!0,setTimeout(()=>{this.cascaderLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.cascaderValue},getcolumn:"yes"}).then(()=>{this.cascaderLoading--,this.initCascaderData()}).catch(()=>{this.cascaderLoading--}))},setData(t){if(!this.isMounted){this.__setData&&clearTimeout(this.__setData),this.__setData=setTimeout(a=>this.setData(t),10);return}typeof t.beforeClose!="undefined"&&(this.beforeClose.push(t.beforeClose),delete t.beforeClose),this.addData=Object.assign({},this.addData,t)},async onAdd(t,a=!1){if(!this.addData.name){$A.messageError("\u4EFB\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");return}if(this.loadIng++,!a&&this.addData.owner.length>0){this.$refs.taskExistTipsRef.isExistTask({userids:this.addData.owner,timerange:this.addData.times}).then(e=>{e?(this.loadIng--,this.again=t):this.onAdd(t,!0)});return}this.$store.dispatch("taskAdd",this.addData).then(({msg:e})=>{this.loadIng--,$A.messageSuccess(e),t===!0?(this.addData=Object.assign({},this.addData,{name:"",content:"",subtasks:[]}),this.$refs.input.focus()):(this.addData={cascader:[],name:"",content:"",owner:[],assist:[],column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:""},this.close())}).catch(({msg:e})=>{this.loadIng--,$A.modalError(e)})},close(){this.$emit("input",!this.value)},showCisibleDropdown(t){var i;let a=null;if(t===null?a=(i=this.$refs.visibilityText)==null?void 0:i.getBoundingClientRect():a=t.target.getBoundingClientRect(),a===null)return;const e=this.$el.getBoundingClientRect(),s=this.$refs.eDropdownRef.$el;s.style.top=a.top-e.top+"px",s.style.left=a.left-e.left+"px",s.style.width=a.width+"px",s.style.height=a.height+"px",this.$refs.eDropdownRef.visible&&this.$refs.eDropdownRef.hide(),setTimeout(()=>{this.$refs.eDropdownRef.show()},0)},visibleUserSelectShowChange(t){if(!t&&(this.addData.visibility_appointor.length==0||!this.addData.visibility_appointor[0])){let a=this.addData.old_visibility_appoint;this.addData.visibility_appoint=a>2?1:a||1,this.addData.visibility_appoint<3}},dropVisible(t){switch(t){case 1:case 2:this.addData.visibility_appoint=t;break;case 3:this.addData.old_visibility_appoint=this.addData.visibility_appoint,this.addData.visibility_appoint=t,this.$nextTick(()=>{this.$refs.visibleUserSelectRef.onSelection()});break}}}},D={};var gt=n(ft,pt,mt,!1,vt,null,null,null);function vt(t){for(let a in D)this[a]=D[a]}var _t=function(){return gt.exports}(),$t=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mobile-back"},[t.isVisible&&t.x>20?e("div",{staticClass:"back-semicircle",style:t.style}):t._e()])},kt=[];const bt={name:"MobileBack",props:{showTabbar:{type:Boolean,default:!1}},data(){return{x:0,y:0,isVisible:!1,isTouched:!1,isScrolling:void 0,touchesStart:{}}},created(){this.appAndroidEvents()},mounted(){document.addEventListener("touchstart",this.touchstart),document.addEventListener("touchmove",this.touchmove,{passive:!1}),document.addEventListener("touchend",this.touchend)},beforeDestroy(){document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)},computed:{...d(["fileLists","messengerSearchKey"]),style(){const a=Math.max(135,this.y)+this.windowScrollY,e=this.windowHeight-135;return{top:Math.min(a,e)+"px"}},routeName(){return this.$route.name},fileFolderId(){const{folderId:t}=this.$route.params;return parseInt(/^\d+$/.test(t)?t:0)}},watch:{isVisible(t){this.$store.state.touchBackInProgress=t}},methods:{getXY(t){const a=t.touches[0];this.x=a.clientX,this.y=a.clientY},touchstart(t){this.getXY(t),this.isTouched=this.canBack()&&this.x<20,this.isScrolling=void 0,this.touchesStart.x=t.type==="touchstart"?t.targetTouches[0].pageX:t.pageX,this.touchesStart.y=t.type==="touchstart"?t.targetTouches[0].pageY:t.pageY},touchmove(t){if(!this.isTouched)return;const a=t.type==="touchmove"?t.targetTouches[0].pageX:t.pageX,e=t.type==="touchmove"?t.targetTouches[0].pageY:t.pageY;if(typeof this.isScrolling=="undefined"&&(this.isScrolling=!!(this.isScrolling||Math.abs(e-this.touchesStart.y)>Math.abs(a-this.touchesStart.x))),this.isScrolling){this.isTouched=!1;return}this.isVisible=!0,this.getXY(t),t.preventDefault()},touchend(){this.x>90&&this.isVisible&&this.onBack(),this.x=0,this.isVisible=!1},canBack(){if(!this.showTabbar||this.$Modal.visibles().length>0||this.fileFolderId>0)return!0;if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts)return!0}else if(this.messengerSearchKey.dialog)return!0}let t=!1;return k.setGlobalData({type:"modalVisible",callback:(a,e)=>{e&&(t=!0)}}),!!t},onBack(){let t=!1;if(k.setGlobalData({type:"route",action:"back",route:this.$route,callback:(a,e)=>{e&&(t=!0)}}),!t&&!this.$Modal.removeLast()){if(this.routeName==="manage-file"){if(this.fileFolderId>0){const a=this.fileLists.find(({id:e,permission:s})=>e==this.fileFolderId&&s>-1);if(a){const e=this.fileLists.find(({id:s,permission:i})=>s==a.pid&&i>-1);if(e){this.goForward({name:"manage-file",params:{folderId:e.id,fileId:null}});return}}this.goForward({name:"manage-file"});return}this.goForward({name:"manage-application"},!0);return}if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts){this.$store.state.messengerSearchKey.contacts="";return}}else if(this.messengerSearchKey.dialog){this.$store.state.messengerSearchKey.dialog="";return}}this.goBack()}},appAndroidEvents(){this.$isEEUiApp&&$A.isAndroid()&&$A.eeuiAppSetPageBackPressed({pageName:"firstPage"},t=>{this.canBack()?this.onBack():$A.eeuiAppGoDesktop()})}}},x={};var yt=n(bt,$t,kt,!1,wt,null,null,null);function wt(t){for(let a in x)this[a]=x[a]}var Dt=function(){return yt.exports}(),xt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.show&&t.userid>0?e("transition",{attrs:{name:"mobile-notify"}},[e("div",{staticClass:"mobile-notification",class:{show:t.show},style:t.notifyStyle,on:{click:function(s){return s.stopPropagation(),t.onClick.apply(null,arguments)},touchstart:t.onTouchstart,touchmove:t.onTouchmove}},[e("UserAvatar",{attrs:{userid:t.userid,size:40,"show-name":"","name-text":t.title}}),e("div",{staticClass:"notification-desc no-dark-content"},[t._v(t._s(t.desc))])],1)]):t._e()},Lt=[];const St={name:"MobileNotification",data(){return{userid:0,title:"",desc:"",duration:6e3,callback:null,show:!1,timer:null,startY:0}},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.show=!1},computed:{notifyStyle(){return{marginTop:this.$store.state.windowScrollY+"px"}}},methods:{open(t){!$A.isJson(t)||(this.userid=t.userid||0,this.title=t.title||"",this.desc=t.desc||"",this.duration=typeof t.duration=="number"?t.duration:6e3,this.callback=typeof t.callback=="function"?t.callback:null,this.show=!0,this.timer&&clearTimeout(this.timer),this.duration>0&&(this.timer=setTimeout(this.close,this.duration)),$A.eeuiAppSendMessage({action:"setVibrate"}))},close(){this.show=!1},onClick(){this.close(),typeof this.callback=="function"&&this.callback()},onTouchstart(t){this.startY=t.touches[0].clientY},onTouchmove(t){this.startY>0&&this.startY-t.touches[0].clientY>10&&(this.startY=0,this.close())}}},L={};var Ct=n(St,xt,Lt,!1,Tt,null,null,null);function Tt(t){for(let a in L)this[a]=L[a]}var It=function(){return Ct.exports}(),At=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{value:t.visible,mask:!1,"mask-closable":!1,"footer-hide":!0,"transition-names":["mobile-dialog",""],beforeClose:t.onBeforeClose,"class-name":"dialog-modal",fullscreen:""}},[t.windowPortrait&&t.dialogId>0?e("DialogWrapper",{attrs:{dialogId:t.dialogId,beforeBack:t.onBeforeClose,location:"modal"}}):t._e()],1)},Mt=[];const jt={name:"DialogModal",components:{DialogWrapper:V},data(){return{timer:null}},computed:{...d(["dialogId"]),visible(){return this.dialogId>0&&this.windowPortrait}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openDialog",0)})}}},S={};var Pt=n(jt,At,Mt,!1,Nt,null,null,null);function Nt(t){for(let a in S)this[a]=S[a]}var Rt=function(){return Pt.exports}(),Bt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{value:t.show,styles:t.styles,"mask-closable":!1,"footer-hide":!0,beforeClose:t.onBeforeClose,"class-name":"task-modal"}},[e("TaskDetail",{ref:"taskDetail",attrs:{"task-id":t.taskId,"open-task":t.taskData,modalMode:""}})],1)},Et=[];const Ut={name:"TaskModal",components:{TaskDetail:z},computed:{...d(["taskId"]),...f(["taskData"]),show(){return this.taskId>0},styles(){return{width:"90%",maxWidth:this.taskData.dialog_id?"1200px":"700px"}}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openTask",0)})},checkUpdate(){if(this.show)return this.$refs.taskDetail.checkUpdate(!0),!0}}},C={};var Ot=n(Ut,Bt,Et,!1,zt,null,null,null);function zt(t){for(let a in C)this[a]=C[a]}var Ft=function(){return Ot.exports}(),Gt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1"),"mask-closable":!1},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("Form",{ref:"exportTask",attrs:{model:t.formData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u5BFC\u51FA\u6210\u5458")}},[e("UserSelect",{attrs:{"multiple-max":100,"avatar-name":"","show-disable":"",title:t.$L("\u8BF7\u9009\u62E9\u6210\u5458")},model:{value:t.formData.userid,callback:function(s){t.$set(t.formData,"userid",s)},expression:"formData.userid"}}),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6BCF\u6B21\u6700\u591A\u9009\u62E9\u5BFC\u51FA100\u4E2A\u6210\u5458")))])],1),e("FormItem",{attrs:{label:t.$L("\u65F6\u95F4\u8303\u56F4")}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.formData.time,callback:function(s){t.$set(t.formData,"time",s)},expression:"formData.time"}}),e("div",{staticClass:"form-tip checkin-export-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(s){t.formData.time=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),e("em",{on:{click:function(s){t.formData.time=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),e("FormItem",{attrs:{prop:"type",label:t.$L("\u5BFC\u51FA\u65F6\u95F4\u7C7B\u578B")}},[e("RadioGroup",{model:{value:t.formData.type,callback:function(s){t.$set(t.formData,"type",s)},expression:"formData.type"}},[e("Radio",{attrs:{label:"taskTime"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u65F6\u95F4")))]),e("Radio",{attrs:{label:"createdTime"}},[t._v(t._s(t.$L("\u521B\u5EFA\u65F6\u95F4")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},Vt=[];const Yt={name:"TaskExport",components:{UserSelect:g},props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{userid:[],time:[],type:"taskTime"}}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},methods:{dateShortcuts(t){if(t==="prev")return[$A.daytz().subtract(1,"month").startOf("day").format("YYYY-MM-DD"),$A.daytz().subtract(1,"month").endOf("day").format("YYYY-MM-DD")];if(t==="this")return[$A.daytz().startOf("day").format("YYYY-MM-DD"),$A.daytz().endOf("day").format("YYYY-MM-DD")]},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"project/task/export",data:this.formData}).then(({data:t})=>{this.show=!1,$A.modalSuccess(t.msg)}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},T={};var Kt=n(Yt,Gt,Vt,!1,Ht,null,null,null);function Ht(t){for(let a in T)this[a]=T[a]}var Wt=function(){return Kt.exports}(),Xt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"project-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u7BA1\u7406"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(s){t.$set(t.keys,"type",s)},expression:"keys.type"}},[e("Option",{attrs:{value:" "}},[t._v(t._s(t.$L("\u5168\u90E8")))]),t._l(t.typeList,function(s,i){return e("Option",{key:i,attrs:{value:s.id}},[t._v(t._s(t.$L(s.label))+" ")])})],2)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.status,callback:function(s){t.$set(t.keys,"status",s)},expression:"keys.status"}},[e("Option",{attrs:{value:" "}},[t._v(t._s(t.$L("\u5168\u90E8")))]),e("Option",{attrs:{value:0}},[t._v(t._s(t.$L("\u5F85\u5904\u7406")))]),e("Option",{attrs:{value:1}},[t._v(t._s(t.$L("\u5DF2\u5904\u7406")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},Jt=[];const qt={name:"ComplaintManagement",data(){const t=[{id:10,label:"\u8BC8\u9A97\u8BF1\u5BFC\u8F6C\u8D26"},{id:20,label:"\u5F15\u6D41\u4E0B\u8F7D\u5176\u4ED6APP\u4ED8\u8D39"},{id:30,label:"\u6572\u8BC8\u52D2\u7D22"},{id:40,label:"\u7167\u7247\u4E0E\u672C\u4EBA\u4E0D\u4E00\u81F4"},{id:50,label:"\u8272\u60C5\u4F4E\u4FD7"},{id:60,label:"\u9891\u7E41\u5E7F\u544A\u9A9A\u6270"},{id:70,label:"\u5176\u4ED6\u95EE\u9898"}];return{loadIng:0,keys:{},keyIs:!1,typeList:t,columns:[{title:"ID",key:"id",width:80,render:(a,{row:e,column:s})=>a("TableAction",{props:{column:s,align:"left"}},[a("div",e.id)])},{title:this.$L("\u4E3E\u62A5\u7C7B\u578B"),key:"type",minWidth:120,render:(a,{row:e})=>{const s=this.$L(t.find(i=>i.id==e.type).label);return a("div",{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},on:{click:()=>{$A.modalInfo({language:!1,title:this.$L("\u4E3E\u62A5\u7C7B\u578B"),content:s})}}},s)}},{title:this.$L("\u72B6\u6001"),key:"status",minWidth:80,render:(a,{row:e})=>{let s=e.status==0?"\u672A\u5904\u7406":"\u5DF2\u5904\u7406";return a("div",{style:{color:e.status==0?"#f00":"inherit"}},[a("AutoTip",this.$L(s))])}},{title:this.$L("\u4E3E\u62A5\u539F\u56E0"),minWidth:150,render:(a,{row:e})=>a("div",{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},on:{click:()=>{$A.modalInfo({language:!1,title:this.$L("\u4E3E\u62A5\u539F\u56E0"),content:e.reason})}}},e.reason)},{title:this.$L("\u4E3E\u62A5\u56FE"),minWidth:85,render:(a,{row:e})=>{var i;const s=(i=JSON.parse(e.imgs))==null?void 0:i.map(o=>({src:$A.apiUrl("../"+o)}));return s.length===0?a("div","-"):a("div",{style:{color:"#1890ff"},on:{click:()=>{this.$store.dispatch("previewImage",{index:0,list:s})}}},[a("AutoTip",this.$L("\u70B9\u51FB\u67E5\u770B"))])}},{title:this.$L("\u4E3E\u62A5\u4EBA"),minWidth:100,render:(a,{row:e})=>a("UserAvatar",{props:{showName:!0,size:22,userid:e.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(a,e)=>{const s=[e.row.status==0&&a("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5904\u7406\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.handle(e.row)}}},this.$L("\u5904\u7406")),a("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:e.row.status==0?"8px":"0",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(e.row)}}},this.$L("\u5220\u9664"))];return a("TableAction",{props:{column:e.column}},s)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.$store.dispatch("call",{url:"complaint/lists",data:{type:this.keys.type,status:this.keys.status,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},handle(t){this.loadIng++,this.$store.dispatch("call",{url:"complaint/action",data:{id:t.id,type:"handle"}}).then(()=>{this.getLists()}).catch(({msg:a})=>{$A.modalError(a)}).finally(a=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:a})=>a!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"complaint/action",data:{id:t.id,type:"delete"}}).then(()=>{this.getLists()}).catch(({msg:a})=>{$A.modalError(a),this.getLists()}).finally(a=>{this.loadIng--})}}},I={};var Qt=n(qt,Xt,Jt,!1,Zt,null,null,null);function Zt(t){for(let a in I)this[a]=I[a]}var te=function(){return Qt.exports}(),ee=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page-manage",class:{"show-tabbar":t.showMobileTabbar,"not-logged":t.userId<=0}},[e("div",{staticClass:"manage-box-menu",class:{"show-mobile-menu":t.showMobileMenu}},[e("Dropdown",{staticClass:"page-manage-menu-dropdown main-menu",attrs:{trigger:"click"},on:{"on-click":t.settingRoute,"on-visible-change":t.menuVisibleChange}},[e("div",{class:["manage-box-title",t.visibleMenu?"menu-visible":""]},[e("div",{staticClass:"manage-box-avatar"},[e("UserAvatar",{attrs:{userid:t.userId,size:36}})],1),e("span",[t._v(t._s(t.userInfo.nickname))]),t.clientNewVersion?e("Badge",{staticClass:"manage-box-top-report",attrs:{dot:""}}):t._e(),e("div",{staticClass:"manage-box-arrow"},[e("Icon",{attrs:{type:"ios-arrow-up"}}),e("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t._l(t.menu,function(s){return[s.path==="taskBrowse"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!s.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t.taskBrowseLists.length>0?e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.taskBrowseLists,function(i,o){return i.id>0&&o<10?e("DropdownItem",{key:o,staticClass:"task-title",attrs:{name:i.name},nativeOn:{click:function(c){return t.openTask(i)}}},[i.flow_item_name?e("span",{class:i.flow_item_status},[t._v(t._s(i.flow_item_name))]):t._e(),e("div",{staticClass:"task-title-text"},[t._v(t._s(i.name))])]):t._e()}),1):e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{staticStyle:{color:"darkgrey"}},[t._v(t._s(t.$L("\u6682\u65E0\u6253\u5F00\u8BB0\u5F55")))])],1)],1):s.path==="team"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!s.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"allUser"}},[t._v(t._s(t.$L("\u56E2\u961F\u7BA1\u7406")))]),e("DropdownItem",{attrs:{name:"exportTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1")))]),e("DropdownItem",{attrs:{name:"exportOverdueTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u8D85\u671F\u4EFB\u52A1")))]),e("DropdownItem",{attrs:{name:"exportApprove"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u5BA1\u6279\u6570\u636E")))]),e("DropdownItem",{attrs:{name:"exportCheckin"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u7B7E\u5230\u6570\u636E")))])],1)],1):s.visible!==!1?e("DropdownItem",{style:s.style||{},attrs:{divided:!!s.divided,name:s.path}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),s.path==="version"?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{text:t.clientNewVersion}}):s.path==="workReport"&&t.reportUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.reportUnreadNumber}}):s.path==="approve"&&t.approveUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.approveUnreadNumber}}):t._e()],1)]):t._e()]})],2)],1),e("Scrollbar",{attrs:{"class-name":"manage-item"},on:{"on-scroll":function(s){t.operateVisible=!1}}},[e("div",{staticClass:"menu-base"},[e("ul",[e("li",{class:t.classNameRoute("dashboard"),on:{click:function(s){return t.toggleRoute("dashboard")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6FB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u4EEA\u8868\u76D8")))]),t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.all_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.all_count}}):t._e()],1),e("li",{class:t.classNameRoute("calendar"),on:{click:function(s){return t.toggleRoute("calendar")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F5")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u65E5\u5386")))])]),e("li",{class:t.classNameRoute("messenger"),on:{click:function(s){return t.toggleRoute("messenger")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6D88\u606F")))]),e("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})],1),e("li",{class:t.classNameRoute("file"),on:{click:function(s){return t.toggleRoute("file")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F3")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6587\u4EF6")))])]),e("li",{class:t.classNameRoute("application"),on:{click:function(s){return t.toggleRoute("application")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE60C")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u5E94\u7528")))]),e("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:String(t.reportUnreadNumber+t.approveUnreadNumber||"")}})],1)])]),e("div",{ref:"menuProject",staticClass:"menu-project"},[e("ul",[t._l(t.projectLists,function(s,i){return e("li",{directives:[{name:"longpress",rawName:"v-longpress",value:t.handleLongpress,expression:"handleLongpress"}],key:i,ref:`project_${s.id}`,refInFor:!0,class:t.classNameProject(s),attrs:{"data-id":s.id},on:{click:function(o){return t.toggleRoute("project",{projectId:s.id})}}},[e("div",{staticClass:"project-h1"},[e("em",{on:{click:function(o){return o.stopPropagation(),t.toggleOpenMenu(s.id)}}}),e("div",{staticClass:"title"},[t._v(t._s(s.name))]),s.top_at?e("div",{staticClass:"icon-top"}):t._e(),s.task_my_num-s.task_my_complete>0?e("div",{staticClass:"num"},[t._v(t._s(s.task_my_num-s.task_my_complete))]):t._e()]),e("div",{staticClass:"project-h2"},[e("p",[e("em",[t._v(t._s(t.$L("\u6211\u7684"))+":")]),e("span",[t._v(t._s(s.task_my_complete)+"/"+t._s(s.task_my_num))]),e("Progress",{attrs:{percent:s.task_my_percent,"stroke-width":6}})],1),e("p",[e("em",[t._v(t._s(t.$L("\u5168\u90E8"))+":")]),e("span",[t._v(t._s(s.task_complete)+"/"+t._s(s.task_num))]),e("Progress",{attrs:{percent:s.task_percent,"stroke-width":6}})],1)])])}),t.projectKeyLoading>0?e("li",{staticClass:"loading"},[e("Loading")],1):t._e()],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.operateVisible,expression:"operateVisible"}],staticClass:"operate-position",style:t.operateStyles},[e("Dropdown",{attrs:{trigger:"custom",placement:t.windowLandscape?"bottom":"top",visible:t.operateVisible,transfer:""},on:{"on-clickoutside":function(s){t.operateVisible=!1}}},[e("div",{style:{userSelect:t.operateVisible?"none":"auto",height:t.operateStyles.height}}),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{nativeOn:{click:function(s){return t.handleTopClick.apply(null,arguments)}}},[t._v(" "+t._s(t.$L(t.operateItem.top_at?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876\u8BE5\u9879\u76EE"))+" ")])],1)],1)],1),t.projectKeyValue||(t.projectSearchShow||t.projectTotal>20)&&t.windowHeight>600?e("div",{staticClass:"manage-project-search"},[e("div",{staticClass:"search-pre"},[t.projectKeyLoading>0?e("Loading"):e("Icon",{attrs:{type:"ios-search"}})],1),e("Input",{attrs:{placeholder:t.$L(`\u5171${t.projectTotal||t.cacheProjects.length}\u4E2A\u9879\u76EE\uFF0C\u641C\u7D22...`),clearable:""},model:{value:t.projectKeyValue,callback:function(s){t.projectKeyValue=s},expression:"projectKeyValue"}})],1):t._e(),e("ButtonGroup",{staticClass:"manage-box-new-group"},[e("Button",{staticClass:"manage-box-new",attrs:{type:"primary",icon:"md-add"},on:{click:t.onAddShow}},[t._v(t._s(t.$L("\u65B0\u5EFA\u9879\u76EE")))]),e("Dropdown",{attrs:{trigger:"click"},on:{"on-click":t.onAddMenu}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"project"}},[t._v(t._s(t.$L("\u65B0\u5EFA\u9879\u76EE"))+" ("+t._s(t.mateName)+"+B)")]),e("DropdownItem",{attrs:{name:"task"}},[t._v(t._s(t.$L("\u65B0\u5EFA\u4EFB\u52A1"))+" ("+t._s(t.mateName)+"+K)")]),e("DropdownItem",{attrs:{name:"group"}},[t._v(t._s(t.$L("\u521B\u5EFA\u7FA4\u7EC4"))+" ("+t._s(t.mateName)+"+U)")]),e("DropdownItem",{attrs:{name:"createMeeting"}},[t._v(t._s(t.$L("\u65B0\u4F1A\u8BAE"))+" ("+t._s(t.mateName)+"+J)")]),e("DropdownItem",{attrs:{name:"joinMeeting"}},[t._v(t._s(t.$L("\u52A0\u5165\u4F1A\u8BAE")))])],1)],1)],1)],1),e("div",{staticClass:"manage-box-main"},[e("keep-alive",[e("router-view",{staticClass:"manage-box-view",on:{"on-click":t.onTabbarClick}})],1)],1),e("Modal",{attrs:{title:t.$L("\u65B0\u5EFA\u9879\u76EE"),"mask-closable":!1},model:{value:t.addShow,callback:function(s){t.addShow=s},expression:"addShow"}},[e("Form",{ref:"addProject",attrs:{model:t.addData,rules:t.addRule,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{prop:"name",label:t.$L("\u9879\u76EE\u540D\u79F0")}},[e("Input",{ref:"projectName",attrs:{type:"text"},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1),t.addData.columns?e("FormItem",{attrs:{label:t.$L("\u4EFB\u52A1\u5217\u8868")}},[e("TagInput",{model:{value:t.addData.columns,callback:function(s){t.$set(t.addData,"columns",s)},expression:"addData.columns"}})],1):e("FormItem",{attrs:{label:t.$L("\u9879\u76EE\u6A21\u677F")}},[e("Select",{attrs:{value:0,placeholder:t.$L("\u8BF7\u9009\u62E9\u6A21\u677F")},on:{"on-change":t.selectChange}},t._l(t.columns,function(s,i){return e("Option",{key:i,attrs:{value:i}},[t._v(t._s(s.name))])}),1)],1),e("FormItem",{attrs:{prop:"flow",label:t.$L("\u5F00\u542F\u5DE5\u4F5C\u6D41")}},[e("RadioGroup",{model:{value:t.addData.flow,callback:function(s){t.$set(t.addData,"flow",s)},expression:"addData.flow"}},[e("Radio",{attrs:{label:"open"}},[t._v(t._s(t.$L("\u5F00\u542F")))]),e("Radio",{attrs:{label:"close"}},[t._v(t._s(t.$L("\u5173\u95ED")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.addShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAddProject}},[t._v(t._s(t.$L("\u6DFB\u52A0")))])],1)],1),e("Modal",{attrs:{"mask-closable":!1,styles:{width:"90%",maxWidth:"640px"},"footer-hide":""},model:{value:t.addTaskShow,callback:function(s){t.addTaskShow=s},expression:"addTaskShow"}},[e("TaskAdd",{ref:"addTask",model:{value:t.addTaskShow,callback:function(s){t.addTaskShow=s},expression:"addTaskShow"}})],1),e("Modal",{attrs:{title:t.$L("\u521B\u5EFA\u7FA4\u7EC4"),"mask-closable":!1},model:{value:t.createGroupShow,callback:function(s){t.createGroupShow=s},expression:"createGroupShow"}},[e("Form",{attrs:{model:t.createGroupData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{prop:"avatar",label:t.$L("\u7FA4\u5934\u50CF")}},[e("ImgUpload",{attrs:{num:1,width:512,height:512,whcut:1},model:{value:t.createGroupData.avatar,callback:function(s){t.$set(t.createGroupData,"avatar",s)},expression:"createGroupData.avatar"}})],1),e("FormItem",{attrs:{prop:"userids",label:t.$L("\u7FA4\u6210\u5458")}},[e("UserSelect",{attrs:{uncancelable:t.createGroupData.uncancelable,"multiple-max":100,"show-bot":"",title:t.$L("\u9009\u62E9\u9879\u76EE\u6210\u5458")},model:{value:t.createGroupData.userids,callback:function(s){t.$set(t.createGroupData,"userids",s)},expression:"createGroupData.userids"}})],1),e("FormItem",{attrs:{prop:"chat_name",label:t.$L("\u7FA4\u540D\u79F0")}},[e("Input",{attrs:{placeholder:t.$L("\u8F93\u5165\u7FA4\u540D\u79F0\uFF08\u9009\u586B\uFF09")},model:{value:t.createGroupData.chat_name,callback:function(s){t.$set(t.createGroupData,"chat_name",s)},expression:"createGroupData.chat_name"}})],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.createGroupShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.createGroupLoad>0},on:{click:t.submitCreateGroup}},[t._v(t._s(t.$L("\u521B\u5EFA")))])],1)],1),e("TaskExport",{model:{value:t.exportTaskShow,callback:function(s){t.exportTaskShow=s},expression:"exportTaskShow"}}),e("CheckinExport",{model:{value:t.exportCheckinShow,callback:function(s){t.exportCheckinShow=s},expression:"exportCheckinShow"}}),e("ApproveExport",{model:{value:t.exportApproveShow,callback:function(s){t.exportApproveShow=s},expression:"exportApproveShow"}}),e("TaskModal",{ref:"taskModal"}),e("DialogModal",{ref:"dialogModal"}),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.workReportShow,callback:function(s){t.workReportShow=s},expression:"workReportShow"}},[t.workReportShow?e("Report",{on:{"on-read":function(s){return t.$store.dispatch("getReportUnread",1e3)}},model:{value:t.reportTabs,callback:function(s){t.reportTabs=s},expression:"reportTabs"}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1380},model:{value:t.allUserShow,callback:function(s){t.allUserShow=s},expression:"allUserShow"}},[t.allUserShow?e("TeamManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.allProjectShow,callback:function(s){t.allProjectShow=s},expression:"allProjectShow"}},[t.allProjectShow?e("ProjectManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.complaintShow,callback:function(s){t.complaintShow=s},expression:"complaintShow"}},[t.complaintShow?e("ComplaintManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.archivedProjectShow,callback:function(s){t.archivedProjectShow=s},expression:"archivedProjectShow"}},[t.archivedProjectShow?e("ProjectArchived"):t._e()],1),e("MeetingManager"),e("transition",{attrs:{name:"mobile-slide"}},[t.showMobileTabbar?e("MobileTabbar",{on:{"on-click":t.onTabbarClick}}):t._e()],1),e("MobileBack",{attrs:{showTabbar:t.showMobileTabbar}}),e("MobileNotification",{ref:"mobileNotification"}),t.$route.name!="manage-apps"?e("MicroApps",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{name:"okr-details",url:t.okrUrl,datas:t.okrWindow}}):t._e()],1)},ae=[];const se={components:{ImgUpload:W,UserSelect:g,TaskExport:Wt,CheckinExport:N,ApproveExport:Y,TaskModal:Ft,DialogModal:Rt,MeetingManager:F,MobileNotification:It,MobileBack:Dt,MobileTabbar:ut,TaskAdd:_t,Report:R,DrawerOverlay:E,ProjectManagement:rt,TeamManagement:B,ProjectArchived:tt,MicroApps:K,ComplaintManagement:te},directives:{longpress:G},data(){return{loadIng:0,mateName:/macintosh|mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl",addShow:!1,addData:{name:"",columns:"",flow:"open"},addRule:{name:[{required:!0,message:this.$L("\u8BF7\u586B\u5199\u9879\u76EE\u540D\u79F0\uFF01"),trigger:"change"},{type:"string",min:2,message:this.$L("\u9879\u76EE\u540D\u79F0\u81F3\u5C112\u4E2A\u5B57\uFF01"),trigger:"change"}]},addTaskShow:!1,addTaskSubscribe:null,createGroupShow:!1,createGroupData:{},createGroupLoad:0,createGroupSubscribe:null,exportTaskShow:!1,exportCheckinShow:!1,exportApproveShow:!1,dialogMsgSubscribe:null,projectKeyValue:"",projectKeyLoading:0,projectSearchShow:!1,openMenu:{},visibleMenu:!1,showMobileMenu:!1,workReportShow:!1,allUserShow:!1,allProjectShow:!1,archivedProjectShow:!1,natificationReady:!1,notificationManage:null,reportTabs:"my",operateStyles:{},operateVisible:!1,operateItem:{},needStartHome:!1,complaintShow:!1}},mounted(){this.notificationInit(),this.addTaskSubscribe=l.Store.subscribe("addTask",this.onAddTask),this.createGroupSubscribe=l.Store.subscribe("createGroup",this.onCreateGroup),this.dialogMsgSubscribe=l.Store.subscribe("dialogMsgPush",this.addDialogMsg),document.addEventListener("keydown",this.shortcutEvent)},activated(){this.$store.dispatch("getUserInfo").catch(t=>{}),this.$store.dispatch("getTaskPriority").catch(t=>{}),this.$store.dispatch("getReportUnread",1e3),this.$store.dispatch("getApproveUnread",1e3),this.$store.dispatch("needHome").then(t=>{this.needStartHome=!0}).catch(t=>{this.needStartHome=!1})},beforeDestroy(){this.addTaskSubscribe&&(this.addTaskSubscribe.unsubscribe(),this.addTaskSubscribe=null),this.createGroupSubscribe&&(this.createGroupSubscribe.unsubscribe(),this.createGroupSubscribe=null),this.dialogMsgSubscribe&&(this.dialogMsgSubscribe.unsubscribe(),this.dialogMsgSubscribe=null),document.removeEventListener("keydown",this.shortcutEvent)},deactivated(){this.addShow=!1},computed:{...d(["userInfo","userIsAdmin","cacheUserBasic","cacheTasks","cacheDialogs","cacheProjects","projectTotal","wsOpenNum","columnTemplate","clientNewVersion","cacheTaskBrowse","dialogIns","reportUnreadNumber","approveUnreadNumber","okrWindow"]),...f(["dashboardTask"]),routeName(){return this.$route.name},okrUrl(){return{}.VITE_OKR_WEB_URL||$A.mainUrl("apps/okr")},msgUnreadMention(){let t=0,a=0;this.cacheDialogs.some(s=>{t+=$A.getDialogUnread(s,!1),a+=$A.getDialogMention(s)}),t>999&&(t="999+"),a>999&&(a="999+");const e=this.msgTodoTotal;return e?a?`@${a}\xB7${e}`:t?`${t}\xB7${e}`:e:t?a?`${t}\xB7@${a}`:String(t):a?`@${a}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(a=>{t+=$A.getDialogNum(a)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((a,e)=>a+(e.todo_num||0),0);return t>0?(t>99?t="99+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},menu(){const{userIsAdmin:t,needStartHome:a}=this,e=[{path:"taskBrowse",name:"\u6700\u8FD1\u6253\u5F00\u7684\u4EFB\u52A1"}];return t?e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"system",name:"\u7CFB\u7EDF\u8BBE\u7F6E"},{path:"license",name:"License Key"},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"allProject",name:"\u6240\u6709\u9879\u76EE",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"},{path:"team",name:"\u56E2\u961F\u7BA1\u7406",divided:!0},{path:"complaint",name:"\u4E3E\u62A5\u7BA1\u7406"}):e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"workReport",name:"\u5DE5\u4F5C\u62A5\u544A",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"}),a?e.push({path:"goHome",name:"\u6253\u5F00\u9996\u9875",divided:!0},{path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58"},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}):e.push({path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58",divided:!0},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}),e},columns(){const t=$A.cloneJSON(this.columnTemplate);return t.unshift({name:this.$L("\u7A7A\u767D\u6A21\u677F"),columns:[]}),t},projectLists(){const{projectKeyValue:t,cacheProjects:a}=this,e=$A.cloneJSON(a).sort((s,i)=>s.top_at||i.top_at?$A.dayjs(i.top_at)-$A.dayjs(s.top_at):i.id-s.id);return t?e.filter(s=>$A.strExists(`${s.name} ${s.desc}`,t)):e},taskBrowseLists(){const{cacheTasks:t,cacheTaskBrowse:a,userId:e}=this;return a.filter(({userid:s})=>s===e).map(({id:s})=>t.find(i=>i.id===s)||{})},showMobileTabbar(){return this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?!0:["manage-dashboard","manage-messenger","manage-application"].includes(this.routeName)}},watch:{$route(){this.chackPass()},userInfo(){this.chackPass()},projectKeyValue(t){t!=""&&setTimeout(()=>{this.projectKeyValue==t&&this.searchProject()},600)},wsOpenNum(t){t<=1||this.$store.dispatch("getBasicData",600)},workReportShow(t){t&&this.$store.dispatch("getReportUnread",0)},"cacheProjects.length":{handler(){this.$nextTick(t=>{const a=this.$refs.menuProject,e=$A.last($A.getObject(a,"children.0.children"));if(e){const s=e.getBoundingClientRect(),i=a.getBoundingClientRect();if(s.top>i.top+i.height){this.projectSearchShow=!0;return}}this.projectSearchShow=!1})},immediate:!0},unreadAndOverdue:{handler(t){this.$Electron&&this.$Electron.sendMessage("setDockBadge",t)},immediate:!0}},methods:{chackPass(){this.userInfo.changepass===1&&this.goForward({name:"manage-setting-password"})},async toggleRoute(t,a){this.showMobileMenu=!1;let e={name:"manage-"+t,params:a||{}},s=await $A.IDBInt("fileFolderId");t==="file"&&s>0&&(e.params.folderId=s),this.goForward(e)},toggleOpenMenu(t){this.$set(this.openMenu,t,!this.openMenu[t])},settingRoute(t){switch(t){case"allUser":this.allUserShow=!0;return;case"allProject":this.allProjectShow=!0;return;case"archivedProject":this.archivedProjectShow=!0;return;case"exportTask":this.exportTaskShow=!0;return;case"exportOverdueTask":this.exportOverdueTask();return;case"exportCheckin":this.exportCheckinShow=!0;return;case"exportApprove":this.exportApproveShow=!0;return;case"workReport":this.reportUnreadNumber>0&&(this.reportTabs="receive"),this.workReportShow=!0;return;case"version":l.Store.set("updateNotification",null);return;case"clearCache":$A.IDBSet("clearCache","handle").then(a=>{$A.reloadUrl()});return;case"goHome":this.needStartHome&&this.goForward("index");return;case"approve":this.menu.findIndex(a=>a.path==t)>-1&&this.goForward({name:"manage-approve"});return;case"okrManage":case"okrAnalyze":this.goForward({path:"/manage/apps/"+(t=="okrManage"?"/#/list":"/#/analysis")});return;case"complaint":this.complaintShow=!0;return;case"logout":$A.modalConfirm({title:"\u9000\u51FA\u767B\u5F55",content:"\u4F60\u786E\u5B9A\u8981\u767B\u51FA\u7CFB\u7EDF\uFF1F",onOk:()=>{this.$store.dispatch("logout",!1)}});return}this.menu.findIndex(a=>a.path==t)>-1&&this.toggleRoute("setting-"+t)},exportOverdueTask(){$A.modalConfirm({title:"\u5BFC\u51FA\u4EFB\u52A1",content:"\u4F60\u786E\u5B9A\u8981\u5BFC\u51FA\u6240\u6709\u8D85\u671F\u4EFB\u52A1\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,a)=>{this.$store.dispatch("call",{url:"project/task/exportoverdue"}).then(({data:e})=>{t(),this.$store.dispatch("downUrl",{url:e.url})}).catch(({msg:e})=>{a(e)})})})},menuVisibleChange(t){this.visibleMenu=t},classNameRoute(t){let a=this.routeName;return(a=="manage-approve"||a=="manage-apps")&&(a="manage-application"),{active:a===`manage-${t}`}},classNameProject(t){return{active:this.routeName==="manage-project"&&this.$route.params.projectId==t.id,"open-menu":this.openMenu[t.id]===!0,operate:t.id==this.operateItem.id&&this.operateVisible}},onAddMenu(t){switch(t){case"project":this.onAddShow();break;case"task":this.onAddTask(0);break;case"group":this.onCreateGroup([this.userId]);break;case"createMeeting":l.Store.set("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":l.Store.set("addMeeting",{type:"join"});break}},onAddShow(){this.$store.dispatch("getColumnTemplate").catch(()=>{}),this.addShow=!0,this.$nextTick(()=>{this.$refs.projectName.focus()})},onAddProject(){this.$refs.addProject.validate(t=>{t&&(this.loadIng++,this.$store.dispatch("call",{url:"project/add",data:this.addData}).then(({data:a,msg:e})=>{$A.messageSuccess(e),this.addShow=!1,this.$refs.addProject.resetFields(),this.$store.dispatch("saveProject",a),this.toggleRoute("project",{projectId:a.id})}).catch(({msg:a})=>{$A.modalError(a)}).finally(a=>{this.loadIng--}))})},searchProject(){setTimeout(()=>{this.projectKeyLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.projectKeyValue}}).finally(t=>{this.projectKeyLoading--})},selectChange(t){this.$nextTick(()=>{this.$set(this.addData,"columns",this.columns[t].columns.join(","))})},shortcutEvent(t){if(t.metaKey||t.ctrlKey)switch(t.keyCode){case 66:t.preventDefault(),this.onAddShow();break;case 75:case 78:t.preventDefault(),this.onAddMenu("task");break;case 85:this.onCreateGroup([this.userId]);break;case 74:t.preventDefault(),this.onAddMenu("createMeeting");break;case 83:this.$refs.taskModal.checkUpdate()&&t.preventDefault();break;case 188:t.preventDefault(),this.toggleRoute("setting");break}},onAddTask(t){this.addTaskShow=!0,this.$nextTick(a=>{let e={owner:[this.userId]};$A.isJson(t)?e=t:/^[1-9]\d*$/.test(t)&&(e.column_id=t),this.$refs.addTask.setData(e)})},openTask(t){this.$store.dispatch("openTask",t)},onCreateGroup(t){$A.isArray(t)||(t=[]),this.createGroupData={userids:t,uncancelable:[this.userId]},this.createGroupShow=!0},submitCreateGroup(){this.createGroupLoad++,this.$store.dispatch("call",{url:"dialog/group/add",data:this.createGroupData}).then(({data:t,msg:a})=>{$A.messageSuccess(a),this.createGroupShow=!1,this.createGroupData={},this.$store.dispatch("saveDialog",t),this.$store.dispatch("openDialog",t.id),this.toggleRoute("messenger",{dialogAction:"dialog"})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.createGroupLoad--})},addDialogMsg(t){var $;if(!this.natificationReady&&!this.$isEEUiApp||this.windowActive&&t.dialog_id===(($=$A.last(this.dialogIns))==null?void 0:$.dialog_id))return;const{id:a,dialog_id:e,dialog_type:s,type:i,msg:o,userid:c}=t;if(c==this.userId)return;let h;switch(i){case"text":h=$A.getMsgTextPreview(o.type==="md"?P(o.text):o.text);break;case"file":h="["+this.$L(o.type=="img"?"\u56FE\u7247\u4FE1\u606F":"\u6587\u4EF6\u4FE1\u606F")+"]";break;default:return}this.__notificationId=a;const v=r=>{if(s==="group"){let u=this.cacheUserBasic.find(m=>m.userid==c);u?p(`${r} (${u.nickname})`):this.$store.dispatch("call",{url:"users/basic",data:{userid:[c]},skipAuthError:!0}).then(({data:m})=>{u=m.find(M=>M.userid==c),u&&p(`${r} (${u.nickname})`)}).catch(m=>{p(r)})}else p(r)},p=r=>{this.__notificationId===a&&(this.__notificationId=null,this.$isEEUiApp?this.$refs.mobileNotification.open({userid:c,title:r,desc:h,callback:()=>{this.goForward({name:"manage-messenger"}),this.$store.dispatch("openDialog",e)}}):this.$Electron?this.$Electron.sendMessage("openNotification",{icon:$A.originUrl("images/logo.png"),title:r,body:h,data:t,tag:"dialog",hasReply:!0,replyPlaceholder:this.$L("\u56DE\u590D\u6D88\u606F")}):(this.notificationManage.replaceOptions({icon:$A.originUrl("images/logo.png"),body:h,data:t,tag:"dialog"}),this.notificationManage.replaceTitle(r),this.notificationManage.userAgreed()))},_=this.cacheDialogs.find(r=>r.id==e);_?v(_.name):this.$store.dispatch("getDialogOne",e).then(({data:r})=>v(r.name)).catch(()=>{})},handleLongpress(t,a){const e=$A.getAttr(a,"data-id"),s=this.projectLists.find(i=>i.id==e);!s||(this.operateVisible=!1,this.operateItem=$A.isJson(s)?s:{},this.$nextTick(()=>{const i=a.getBoundingClientRect();this.operateStyles={left:`${t.clientX}px`,top:`${i.top+this.windowScrollY}px`,height:i.height+"px"},this.operateVisible=!0}))},handleTopClick(){this.$store.dispatch("call",{url:"project/top",data:{project_id:this.operateItem.id}}).then(({data:t})=>{this.$store.dispatch("saveProject",t),this.$nextTick(()=>{const a=this.$refs.menuProject.querySelector(".active");a&&$A.scrollIntoViewIfNeeded(a)})}).catch(({msg:t})=>{$A.modalError(t)})},onTabbarClick(t){switch(t){case"addTask":this.onAddTask(0);break;case"addProject":this.onAddShow();break;case"allUser":case"complaint":case"workReport":this.settingRoute(t);break}},notificationInit(){this.notificationManage=new H(this.$L("\u6253\u5F00\u901A\u77E5\u6210\u529F")),this.notificationManage.support&&(this.notificationManage.notificationEvent({onclick:({target:t})=>{console.log("[Notification] A Click",t),this.notificationManage.close(),this.notificationClick(t),window.focus()}}),this.notificationPermission()),this.$Electron&&(this.$Electron.registerMsgListener("clickNotification",t=>{console.log("[Notification] B Click",t),this.$Electron.sendMessage("mainWindowActive"),this.notificationClick(t)}),this.$Electron.registerMsgListener("replyNotification",t=>{console.log("[Notification] B Reply",t),this.notificationReply(t)}))},notificationPermission(){const t=a=>{switch(a){case"already granted":case"granted":return this.natificationReady=!0;case"close":return this.notificationManage.initNotification(t);case"denied":case"already denied":console.log(a==="denied"?"\u60A8\u521A\u521A\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E":"\u60A8\u66FE\u7EA7\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E");break}};this.notificationManage.initNotification(t)},notificationClick(t){const{tag:a,data:e}=t;if(a=="dialog"){if(!$A.isJson(e))return;this.goForward({name:"manage-messenger"}),this.$nextTick(s=>{this.$store.dispatch("openDialog",e.dialog_id)})}},notificationReply(t){const{tag:a,data:e,reply:s}=t;a=="dialog"&&s&&this.$store.dispatch("call",{url:"dialog/msg/sendtext",data:{dialog_id:e.dialog_id,text:s},method:"post"}).then(({data:i})=>{this.$store.dispatch("saveDialogMsg",i),this.$store.dispatch("increaseTaskMsgNum",i),this.$store.dispatch("increaseMsgReplyNum",i),this.$store.dispatch("updateDialogLastMsg",i)}).catch(({msg:i})=>{$A.modalError(i)})}}},A={};var ie=n(se,ee,ae,!1,oe,null,null,null);function oe(t){for(let a in A)this[a]=A[a]}var fa=function(){return ie.exports}();export{fa as default};
