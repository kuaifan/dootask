import{n as r,_ as n}from"./app.b25a7691.js";import{I as a}from"./IFrame.1b90d10b.js";var l=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"file-preview"},[e.isPreview?t("IFrame",{staticClass:"preview-iframe",attrs:{src:e.previewUrl},on:{"on-load":e.onFrameLoad}}):e.contentDetail?[t("div",{directives:[{name:"show",rawName:"v-show",value:e.headerShow&&!["word","excel","ppt"].includes(e.file.type),expression:"headerShow && !['word', 'excel', 'ppt'].includes(file.type)"}],staticClass:"edit-header"},[t("div",{staticClass:"header-title"},[t("div",{staticClass:"title-name"},[e._v(e._s(e.$A.getFileName(e.file)))]),t("Tag",{attrs:{color:"default"}},[e._v(e._s(e.$L("\u53EA\u8BFB")))]),t("div",{staticClass:"refresh"},[e.contentLoad?t("Loading"):t("Icon",{attrs:{type:"ios-refresh"},on:{click:e.getContent}})],1)],1)]),t("div",{staticClass:"content-body"},[e.file.type=="document"?[e.contentDetail.type=="md"?t("MDPreview",{attrs:{initialValue:e.contentDetail.content}}):t("TEditor",{attrs:{value:e.contentDetail.content,height:"100%",readOnly:""}})]:e.file.type=="drawio"?t("Drawio",{ref:"myFlow",attrs:{value:e.contentDetail,title:e.file.name,readOnly:""}}):e.file.type=="mind"?t("Minder",{ref:"myMind",attrs:{value:e.contentDetail,readOnly:""}}):["code","txt"].includes(e.file.type)?t("AceEditor",{attrs:{value:e.contentDetail.content,ext:e.file.ext,readOnly:""}}):["word","excel","ppt"].includes(e.file.type)?t("OnlyOffice",{attrs:{value:e.contentDetail,code:e.code,historyId:e.historyId,documentKey:e.documentKey,readOnly:""}}):e._e()],2)]:e._e(),e.contentLoad?t("div",{staticClass:"content-load"},[t("Loading")],1):e._e()],2)},s=[];const d=()=>n(()=>import("./preview.f52fb3cf.js"),["js/build/preview.f52fb3cf.js","js/build/app.b25a7691.js","js/build/app.f50309b1.css"]),c=()=>n(()=>import("./TEditor.070980fd.js"),["js/build/TEditor.070980fd.js","js/build/app.b25a7691.js","js/build/app.f50309b1.css","js/build/ImgUpload.79355648.js"]),u=()=>n(()=>import("./AceEditor.4add6be1.js"),["js/build/AceEditor.4add6be1.js","js/build/app.b25a7691.js","js/build/app.f50309b1.css"]),_=()=>n(()=>import("./OnlyOffice.d1ac046a.js"),["js/build/OnlyOffice.d1ac046a.js","js/build/OnlyOffice.d095e45d.css","js/build/app.b25a7691.js","js/build/app.f50309b1.css","js/build/IFrame.1b90d10b.js"]),h=()=>n(()=>import("./Drawio.8cd4d7d1.js"),["js/build/Drawio.8cd4d7d1.js","js/build/Drawio.fc5c6326.css","js/build/app.b25a7691.js","js/build/app.f50309b1.css","js/build/IFrame.1b90d10b.js"]),p=()=>n(()=>import("./Minder.cea903bd.js"),["js/build/Minder.cea903bd.js","js/build/Minder.3ba64342.css","js/build/IFrame.1b90d10b.js","js/build/app.b25a7691.js","js/build/app.f50309b1.css"]),v={name:"FilePreview",components:{IFrame:a,AceEditor:u,TEditor:c,MDPreview:d,OnlyOffice:_,Drawio:h,Minder:p},props:{code:{type:String,default:""},historyId:{type:Number,default:0},file:{type:Object,default:()=>({})},headerShow:{type:Boolean,default:!0}},data(){return{loadContent:0,contentDetail:null,loadPreview:!0}},watch:{"file.id":{handler(e){e&&(this.contentDetail=null,this.getContent())},immediate:!0,deep:!0}},computed:{contentLoad(){return this.loadContent>0||this.previewLoad},isPreview(){return this.contentDetail&&this.contentDetail.preview===!0},previewLoad(){return this.isPreview&&this.loadPreview===!0},previewUrl(){if(this.isPreview){const{name:e,key:i}=this.contentDetail;return $A.apiUrl(`../online/preview/${e}?key=${i}`)}return""}},methods:{onFrameLoad(){this.loadPreview=!1},getContent(){if(["word","excel","ppt"].includes(this.file.type)){this.contentDetail=$A.cloneJSON(this.file);return}setTimeout(e=>{this.loadContent++},600),this.$store.dispatch("call",{url:"file/content",data:{id:this.code||this.file.id,history_id:this.historyId}}).then(({data:e})=>{this.contentDetail=e.content}).catch(({msg:e})=>{$A.modalError(e)}).finally(e=>{this.loadContent--})},documentKey(){return new Promise((e,i)=>{this.$store.dispatch("call",{url:"file/content",data:{id:this.code||this.file.id,only_update_at:"yes"}}).then(({data:t})=>{e(`${t.id}-${$A.Time(t.update_at)}`)}).catch(t=>{i(t)})})},exportMenu(e){switch(this.file.type){case"mind":this.$refs.myMind.exportHandle(e,this.file.name);break}}}},o={};var f=r(v,l,s,!1,m,null,null,null);function m(e){for(let i in o)this[i]=o[i]}var D=function(){return f.exports}();export{D as default};
